function FastClick(e){"use strict";var t,i=this;if(this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=e,!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(i,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(i,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(i,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(i,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(i,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(i,arguments)},FastClick.notNeeded(e)||(this.deviceIsAndroid&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,i,n){var s=Node.prototype.removeEventListener;"click"===t?s.call(e,t,i.hijacked||i,n):s.call(e,t,i,n)},e.addEventListener=function(t,i,n){var s=Node.prototype.addEventListener;"click"===t?s.call(e,t,i.hijacked||(i.hijacked=function(e){e.propagationStopped||i(e)}),n):s.call(e,t,i,n)}),"function"==typeof e.onclick&&(t=e.onclick,e.addEventListener("click",function(e){t(e)},!1),e.onclick=null))}!function(e,t){"use strict";e.rails!==t&&e.error("jquery-ujs has already been loaded!");var i,n=e(document);e.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not([form]):not(form button), button[data-confirm]:not([form]):not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]), textarea[name][required]:not([disabled])",fileInputSelector:"input[name][type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return e("meta[name=csrf-token]").attr("content")},csrfParam:function(){return e("meta[name=csrf-param]").attr("content")},CSRFProtection:function(e){var t=i.csrfToken();t&&e.setRequestHeader("X-CSRF-Token",t)},refreshCSRFTokens:function(){e('form input[name="'+i.csrfParam()+'"]').val(i.csrfToken())},fire:function(t,i,n){var s=e.Event(i);return t.trigger(s,n),!1!==s.result},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e[0].href},isRemote:function(e){return e.data("remote")!==t&&!1!==e.data("remote")},handleRemote:function(n){var s,r,o,a,l,c;if(i.fire(n,"ajax:before")){if(a=n.data("with-credentials")||null,l=n.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,n.is("form")){s=n.data("ujs:submit-button-formmethod")||n.attr("method"),r=n.data("ujs:submit-button-formaction")||n.attr("action"),o=e(n[0]).serializeArray();var h=n.data("ujs:submit-button");h&&(o.push(h),n.data("ujs:submit-button",null)),n.data("ujs:submit-button-formmethod",null),n.data("ujs:submit-button-formaction",null)}else n.is(i.inputChangeSelector)?(s=n.data("method"),r=n.data("url"),o=n.serialize(),n.data("params")&&(o=o+"&"+n.data("params"))):n.is(i.buttonClickSelector)?(s=n.data("method")||"get",r=n.data("url"),o=n.serialize(),n.data("params")&&(o=o+"&"+n.data("params"))):(s=n.data("method"),r=i.href(n),o=n.data("params")||null);return c={type:s||"GET",data:o,dataType:l,beforeSend:function(e,s){if(s.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+s.accepts.script),!i.fire(n,"ajax:beforeSend",[e,s]))return!1;n.trigger("ajax:send",e)},success:function(e,t,i){n.trigger("ajax:success",[e,t,i])},complete:function(e,t){n.trigger("ajax:complete",[e,t])},error:function(e,t,i){n.trigger("ajax:error",[e,t,i])},crossDomain:i.isCrossDomain(r)},a&&(c.xhrFields={withCredentials:a}),r&&(c.url=r),i.ajax(c)}return!1},isCrossDomain:function(e){var t=document.createElement("a");t.href=location.href;var i=document.createElement("a");try{return i.href=e,i.href=i.href,!((!i.protocol||":"===i.protocol)&&!i.host||t.protocol+"//"+t.host==i.protocol+"//"+i.host)}catch(e){return!0}},handleMethod:function(n){var s=i.href(n),r=n.data("method"),o=n.attr("target"),a=i.csrfToken(),l=i.csrfParam(),c=e('<form method="post" action="'+s+'"></form>'),h='<input name="_method" value="'+r+'" type="hidden" />';l===t||a===t||i.isCrossDomain(s)||(h+='<input name="'+l+'" value="'+a+'" type="hidden" />'),o&&c.attr("target",o),c.hide().append(h).appendTo("body"),c.submit()},formElements:function(t,i){return t.is("form")?e(t[0].elements).filter(i):t.find(i)},disableFormElements:function(t){i.formElements(t,i.disableSelector).each(function(){i.disableFormElement(e(this))})},disableFormElement:function(e){var i,n;i=e.is("button")?"html":"val",n=e.data("disable-with"),n!==t&&(e.data("ujs:enable-with",e[i]()),e[i](n)),e.prop("disabled",!0),e.data("ujs:disabled",!0)},enableFormElements:function(t){i.formElements(t,i.enableSelector).each(function(){i.enableFormElement(e(this))})},enableFormElement:function(e){var i=e.is("button")?"html":"val";e.data("ujs:enable-with")!==t&&(e[i](e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.prop("disabled",!1),e.removeData("ujs:disabled")},allowAction:function(e){var t,n=e.data("confirm"),s=!1;if(!n)return!0;if(i.fire(e,"confirm")){try{s=i.confirm(n)}catch(e){(console.error||console.log).call(console,e.stack||e)}t=i.fire(e,"confirm:complete",[s])}return s&&t},blankInputs:function(t,i,n){var s,r,o,a,l=e(),c=i||"input,textarea",h=t.find(c),u={};return h.each(function(){s=e(this),s.is("input[type=radio]")?(a=s.attr("name"),u[a]||(0===t.find('input[type=radio]:checked[name="'+a+'"]').length&&(o=t.find('input[type=radio][name="'+a+'"]'),l=l.add(o)),u[a]=a)):(r=s.is("input[type=checkbox],input[type=radio]")?s.is(":checked"):!!s.val())===n&&(l=l.add(s))}),!!l.length&&l},nonBlankInputs:function(e,t){return i.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){var n=e.data("disable-with");n!==t&&(e.data("ujs:enable-with",e.html()),e.html(n)),e.bind("click.railsDisable",function(e){return i.stopEverything(e)}),e.data("ujs:disabled",!0)},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable"),e.removeData("ujs:disabled")}},i.fire(n,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,n){e.crossDomain||i.CSRFProtection(n)}),e(window).on("pageshow.rails",function(){e(e.rails.enableSelector).each(function(){var t=e(this);t.data("ujs:disabled")&&e.rails.enableFormElement(t)}),e(e.rails.linkDisableSelector).each(function(){var t=e(this);t.data("ujs:disabled")&&e.rails.enableElement(t)})}),n.on("ajax:complete",i.linkDisableSelector,function(){i.enableElement(e(this))}),n.on("ajax:complete",i.buttonDisableSelector,function(){i.enableFormElement(e(this))}),n.on("click.rails",i.linkClickSelector,function(t){var n=e(this),s=n.data("method"),r=n.data("params"),o=t.metaKey||t.ctrlKey;if(!i.allowAction(n))return i.stopEverything(t);if(!o&&n.is(i.linkDisableSelector)&&i.disableElement(n),i.isRemote(n)){if(o&&(!s||"GET"===s)&&!r)return!0;var a=i.handleRemote(n);return!1===a?i.enableElement(n):a.fail(function(){i.enableElement(n)}),!1}return s?(i.handleMethod(n),!1):void 0}),n.on("click.rails",i.buttonClickSelector,function(t){var n=e(this);if(!i.allowAction(n)||!i.isRemote(n))return i.stopEverything(t);n.is(i.buttonDisableSelector)&&i.disableFormElement(n);var s=i.handleRemote(n);return!1===s?i.enableFormElement(n):s.fail(function(){i.enableFormElement(n)}),!1}),n.on("change.rails",i.inputChangeSelector,function(t){var n=e(this);return i.allowAction(n)&&i.isRemote(n)?(i.handleRemote(n),!1):i.stopEverything(t)}),n.on("submit.rails",i.formSubmitSelector,function(n){var s,r,o=e(this),a=i.isRemote(o);if(!i.allowAction(o))return i.stopEverything(n);if(o.attr("novalidate")===t)if(o.data("ujs:formnovalidate-button")===t){if((s=i.blankInputs(o,i.requiredInputSelector,!1))&&i.fire(o,"ajax:aborted:required",[s]))return i.stopEverything(n)}else o.data("ujs:formnovalidate-button",t);if(a){if(r=i.nonBlankInputs(o,i.fileInputSelector)){setTimeout(function(){i.disableFormElements(o)},13);var l=i.fire(o,"ajax:aborted:file",[r]);return l||setTimeout(function(){i.enableFormElements(o)},13),l}return i.handleRemote(o),!1}setTimeout(function(){i.disableFormElements(o)},13)}),n.on("click.rails",i.formInputClickSelector,function(t){var n=e(this);if(!i.allowAction(n))return i.stopEverything(t);var s=n.attr("name"),r=s?{name:s,value:n.val()}:null,o=n.closest("form");0===o.length&&(o=e("#"+n.attr("form"))),o.data("ujs:submit-button",r),o.data("ujs:formnovalidate-button",n.attr("formnovalidate")),o.data("ujs:submit-button-formaction",n.attr("formaction")),o.data("ujs:submit-button-formmethod",n.attr("formmethod"))}),n.on("ajax:send.rails",i.formSubmitSelector,function(t){this===t.target&&i.disableFormElements(e(this))}),n.on("ajax:complete.rails",i.formSubmitSelector,function(t){this===t.target&&i.enableFormElements(e(this))}),e(function(){i.refreshCSRFTokens()}))}(jQuery),function(){"use strict";var Faye={VERSION:"1.0.1",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,extend:function(e,t,i){if(!t)return e;for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)&&!1===i||e[n]!==t[n]&&(e[n]=t[n]));return e},random:function(e){return e=e||this.ID_LENGTH,csprng(e,36)},clientIdFromMessages:function(e){var t=this.filter([].concat(e),function(e){return"/meta/connect"===e.channel});return t[0]&&t[0].clientId},copyObject:function(e){var t,i,n;if(e instanceof Array){for(t=[],i=e.length;i--;)t[i]=Faye.copyObject(e[i]);return t}if("object"==typeof e){t=null===e?null:{};for(n in e)t[n]=Faye.copyObject(e[n]);return t}return e},commonElement:function(e,t){for(var i=0,n=e.length;i<n;i++)if(-1!==this.indexOf(t,e[i]))return e[i];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},map:function(e,t,i){if(e.map)return e.map(t,i);var n=[];if(e instanceof Array)for(var s=0,r=e.length;s<r;s++)n.push(t.call(i||null,e[s],s));else for(var o in e)e.hasOwnProperty(o)&&n.push(t.call(i||null,o,e[o]));return n},filter:function(e,t,i){if(e.filter)return e.filter(t,i);for(var n=[],s=0,r=e.length;s<r;s++)t.call(i||null,e[s],s)&&n.push(e[s]);return n},asyncEach:function(e,t,i,n){var s=e.length,r=-1,o=0,a=!1,l=function(){if(o-=1,(r+=1)===s)return i&&i.call(n);t(e[r],h)},c=function(){if(!a){for(a=!0;o>0;)l();a=!1}},h=function(){o+=1,c()};h()},toJSON:function(e){return this.stringify?this.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t}):JSON.stringify(e)}};"undefined"!=typeof module?module.exports=Faye:"undefined"!=typeof window&&(window.Faye=Faye),Faye.Class=function(e,t){"function"!=typeof e&&(t=e,e=Object);var i=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},n=function(){};return n.prototype=e.prototype,i.prototype=new n,Faye.extend(i.prototype,t),i},function(){function e(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0;i<e.length;i++)if(t===e[i])return i;return-1}var t=Faye.EventEmitter=function(){},i="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||i(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);t.apply(this,n)}return!0}if(i(t)){for(var n=Array.prototype.slice.call(arguments,1),s=t.slice(),r=0,o=s.length;r<o;r++)s[r].apply(this,n);return!0}return!1},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var i=this;return i.on(e,function n(){i.removeListener(e,n),t.apply(this,arguments)}),this},t.prototype.removeListener=function(t,n){if("function"!=typeof n)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var s=this._events[t];if(i(s)){var r=e(s,n);if(r<0)return this;s.splice(r,1),0==s.length&&delete this._events[t]}else this._events[t]===n&&delete this._events[t];return this},t.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),i(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}(),Faye.Namespace=Faye.Class({initialize:function(){this._used={}},exists:function(e){return this._used.hasOwnProperty(e)},generate:function(){for(var e=Faye.random();this._used.hasOwnProperty(e);)e=Faye.random();return this._used[e]=e},release:function(e){delete this._used[e]}}),function(){var e,t=setTimeout;e="function"==typeof setImmediate?function(e){setImmediate(e)}:"object"==typeof process&&process.nextTick?function(e){process.nextTick(e)}:function(e){t(e,0)};var i=0,n=1,s=2,r=function(e){return e},o=function(e){throw e},a=function(e){if(this._state=i,this._callbacks=[],this._errbacks=[],"function"==typeof e){var t=this;e(function(e){d(t,e)},function(e){f(t,e)})}};a.prototype.then=function(e,t){var i={},n=this;return i.promise=new a(function(s,r){i.fulfill=s,i.reject=r,l(n,e,i),c(n,t,i)}),i.promise};var l=function(e,t,s){"function"!=typeof t&&(t=r);var o=function(e){h(t,e,s)};e._state===i?e._callbacks.push(o):e._state===n&&o(e._value)},c=function(e,t,n){"function"!=typeof t&&(t=o);var r=function(e){h(t,e,n)};e._state===i?e._errbacks.push(r):e._state===s&&r(e._reason)},h=function(t,i,n){e(function(){u(t,i,n)})},u=function(e,t,i){var n,s,o,a=!1;try{if(n=e(t),s=typeof n,o=null!==n&&("function"===s||"object"===s)&&n.then,n===i.promise)return i.reject(new TypeError("Recursive promise chain detected"));if("function"!=typeof o)return i.fulfill(n);o.call(n,function(e){a||(a=!0,u(r,e,i))},function(e){a||(a=!0,i.reject(e))})}catch(e){if(a)return;a=!0,i.reject(e)}},d=a.fulfill=a.resolve=function(e,t){if(e._state===i){e._state=n,e._value=t,e._errbacks=[];for(var s,r=e._callbacks;s=r.shift();)s(t)}},f=a.reject=function(e,t){if(e._state===i){e._state=s,e._reason=t,e._callbacks=[];for(var n,r=e._errbacks;n=r.shift();)n(t)}};a.defer=e,a.deferred=a.pending=function(){var e={};return e.promise=new a(function(t,i){e.fulfill=e.resolve=t,e.reject=i}),e},a.fulfilled=a.resolved=function(e){return new a(function(t){t(e)})},a.rejected=function(e){return new a(function(t,i){i(e)})},void 0===Faye?module.exports=a:Faye.Promise=a}(),Faye.Set=Faye.Class({initialize:function(){this._index={}},add:function(e){var t=e.id!==undefined?e.id:e;return!this._index.hasOwnProperty(t)&&(this._index[t]=e,!0)},forEach:function(e,t){for(var i in this._index)this._index.hasOwnProperty(i)&&e.call(t,this._index[i])},isEmpty:function(){for(var e in this._index)if(this._index.hasOwnProperty(e))return!1;return!0},member:function(e){for(var t in this._index)if(this._index[t]===e)return!0;return!1},remove:function(e){var t=e.id!==undefined?e.id:e,i=this._index[t];return delete this._index[t],i},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),Faye.URI={isURI:function(e){return e&&e.protocol&&e.host&&e.path},isSameOrigin:function(e){var t=Faye.ENV.location;return e.protocol===t.protocol&&e.hostname===t.hostname&&e.port===t.port},parse:function(e){if("string"!=typeof e)return e;var t,i,n,s,r,o,a={},l=function(t,i){e=e.replace(i,function(e){return a[t]=e,""}),a[t]=a[t]||""};for(l("protocol",/^[a-z]+\:/i),l("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||a.host||(e=Faye.ENV.location.pathname.replace(/[^\/]*$/,"")+e),l("pathname",/^[^\?#]*/),l("search",/^\?[^#]*/),l("hash",/^#.*/),a.protocol=a.protocol||Faye.ENV.location.protocol,a.host?(a.host=a.host.substr(2),t=a.host.split(":"),a.hostname=t[0],a.port=t[1]||""):(a.host=Faye.ENV.location.host,a.hostname=Faye.ENV.location.hostname,a.port=Faye.ENV.location.port),a.pathname=a.pathname||"/",a.path=a.pathname+a.search,i=a.search.replace(/^\?/,""),n=i?i.split("&"):[],o={},s=0,r=n.length;s<r;s++)t=n[s].split("="),o[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return a.query=o,a.href=this.stringify(a),a},stringify:function(e){var t=e.protocol+"//"+e.hostname;return e.port&&(t+=":"+e.port),t+=e.pathname+this.queryString(e.query)+(e.hash||"")},queryString:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return 0===t.length?"":"?"+t.join("&")}},Faye.Error=Faye.Class({initialize:function(e,t,i){this.code=e,this.params=Array.prototype.slice.call(t),this.message=i},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),Faye.Error.parse=function(e){if(e=e||"",!Faye.Grammar.ERROR.test(e))return new this(null,[],e);var t=e.split(":"),i=parseInt(t[0]),n=t[1].split(","),e=t[2];return new this(i,n,e)},Faye.Error.versionMismatch=function(){return new this(300,arguments,"Version mismatch").toString()},Faye.Error.conntypeMismatch=function(){return new this(301,arguments,"Connection types not supported").toString()},Faye.Error.extMismatch=function(){return new this(302,arguments,"Extension mismatch").toString()},Faye.Error.badRequest=function(){return new this(400,arguments,"Bad request").toString()},Faye.Error.clientUnknown=function(){return new this(401,arguments,"Unknown client").toString()},Faye.Error.parameterMissing=function(){return new this(402,arguments,"Missing required parameter").toString()},Faye.Error.channelForbidden=function(){return new this(403,arguments,"Forbidden channel").toString()},Faye.Error.channelUnknown=function(){return new this(404,arguments,"Unknown channel").toString()},Faye.Error.channelInvalid=function(){return new this(405,arguments,"Invalid channel").toString()},Faye.Error.extUnknown=function(){return new this(406,arguments,"Unknown extension").toString()},Faye.Error.publishFailed=function(){return new this(407,arguments,"Failed to publish").toString()},Faye.Error.serverError=function(){return new this(500,arguments,"Internal server error").toString()},Faye.Deferrable={then:function(e,t){var i=this;return this._promise||(this._promise=new Faye.Promise(function(e,t){i._fulfill=e,i._reject=t})),0===arguments.length?this._promise:this._promise.then(e,t)},callback:function(e,t){return this.then(function(i){e.call(t,i)})},errback:function(e,t){return this.then(null,function(i){e.call(t,i)})},timeout:function(e,t){this.then();var i=this;this._timer=Faye.ENV.setTimeout(function(){i._reject(t)},1e3*e)},setDeferredStatus:function(e,t){this._timer&&Faye.ENV.clearTimeout(this._timer);this.then();"succeeded"===e?this._fulfill(t):"failed"===e?this._reject(t):delete this._promise}},Faye.Publisher={countListeners:function(e){return this.listeners(e).length},bind:function(e,t,i){var n=Array.prototype.slice,s=function(){t.apply(i,n.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([e,t,i,s]),this.on(e,s)},unbind:function(e,t,i){this._listeners=this._listeners||[];for(var n,s=this._listeners.length;s--;)n=this._listeners[s],n[0]===e&&(!t||n[1]===t&&n[2]===i)&&(this._listeners.splice(s,1),this.removeListener(e,n[3]))}},Faye.extend(Faye.Publisher,Faye.EventEmitter.prototype),Faye.Publisher.trigger=Faye.Publisher.emit,Faye.Timeouts={addTimeout:function(e,t,i,n){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var s=this;this._timeouts[e]=Faye.ENV.setTimeout(function(){delete s._timeouts[e],i.call(n)},1e3*t)}},removeTimeout:function(e){this._timeouts=this._timeouts||{};var t=this._timeouts[e];t&&(clearTimeout(t),delete this._timeouts[e])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var e in this._timeouts)this.removeTimeout(e)}},Faye.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,t){if(Faye.logger){var e=Array.prototype.slice.apply(e),i="[Faye",n=this.className,s=e.shift().replace(/\?/g,function(){try{return Faye.toJSON(e.shift())}catch(e){return"[Object]"}});for(var r in Faye)n||"function"==typeof Faye[r]&&this instanceof Faye[r]&&(n=r);n&&(i+="."+n),i+="] ","function"==typeof Faye.logger[t]?Faye.logger[t](i+s):"function"==typeof Faye.logger&&Faye.logger(i+s)}}},function(){for(var e in Faye.Logging.LOG_LEVELS)!function(e){Faye.Logging[e]=function(){this.writeLog(arguments,e)}}(e,Faye.Logging.LOG_LEVELS[e])}(),Faye.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},Faye.Extensible={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,i,n,s){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return n.call(s,t);var r=this._extensions.slice(),o=function(t){if(!t)return n.call(s,t);var a=r.shift();if(!a)return n.call(s,t);var l=a[e];if(!l)return o(t);l.length>=3?a[e](t,i,o):a[e](t,o)};o(t)}},Faye.extend(Faye.Extensible,Faye.Logging),Faye.Channel=Faye.Class({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}}),Faye.extend(Faye.Channel.prototype,Faye.Publisher),Faye.extend(Faye.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),i=["/**",e],n=t.slice();n[n.length-1]="*",i.push(this.unparse(n));for(var s=1,r=t.length;s<r;s++)n=t.slice(0,s),n.push("**"),i.push(this.unparse(n));return i},isValid:function(e){return Faye.Grammar.CHANNEL_NAME.test(e)||Faye.Grammar.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:Faye.Class({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t,i){if(t)for(var n,s=0,r=e.length;s<r;s++){n=e[s];var o=this._channels[n]=this._channels[n]||new Faye.Channel(n);o.bind("message",t,i)}},unsubscribe:function(e,t,i){var n=this._channels[e];return!!n&&(n.unbind("message",t,i),!!n.isUnused()&&(this.remove(e),!0))},distributeMessage:function(e){for(var t=Faye.Channel.expand(e.channel),i=0,n=t.length;i<n;i++){var s=this._channels[t[i]];s&&s.trigger("message",e.data)}}})}),Faye.Envelope=Faye.Class({initialize:function(e,t){this.id=e.id,this.message=e,t!==undefined&&this.timeout(t/1e3,!1)}}),Faye.extend(Faye.Envelope.prototype,Faye.Deferrable),Faye.Publication=Faye.Class(Faye.Deferrable),Faye.Subscription=Faye.Class({initialize:function(e,t,i,n){this._client=e,this._channels=t,this._callback=i,this._context=n,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),Faye.extend(Faye.Subscription.prototype,Faye.Deferrable),Faye.Client=Faye.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_RETRY:5,MAX_REQUEST_SIZE:2048,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),this._options=t||{},this.endpoint=Faye.URI.parse(e||this.DEFAULT_ENDPOINT),this.endpoints=this._options.endpoints||{},this.transports={},this.cookies=Faye.CookieJar&&new Faye.CookieJar,this.headers={},this.ca=this._options.ca,this._disabled=[],this._retry=this._options.retry||this.DEFAULT_RETRY;for(var i in this.endpoints)this.endpoints[i]=Faye.URI.parse(this.endpoints[i]);this.maxRequestSize=this.MAX_REQUEST_SIZE,this._state=this.UNCONNECTED,this._channels=new Faye.Channel.Set,this._messageId=0,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(this._options.interval||this.INTERVAL),timeout:1e3*(this._options.timeout||this.CONNECTION_TIMEOUT)},Faye.Event&&Faye.ENV.onbeforeunload!==undefined&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.indexOf(this._disabled,"autodisconnect")<0&&this.disconnect()},this)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this.headers[e]=t},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var i=this;this.info("Initiating handshake with ?",Faye.URI.stringify(this.endpoint)),this._selectTransport(Faye.MANDATORY_CONNECTION_TYPES),this._send({channel:Faye.Channel.HANDSHAKE,version:Faye.BAYEUX_VERSION,supportedConnectionTypes:[this._transport.connectionType]},function(n){n.successful?(this._state=this.CONNECTED,this._clientId=n.clientId,this._selectTransport(n.supportedConnectionTypes),this.info("Handshake successful: ?",this._clientId),this.subscribe(this._channels.getKeys(),!0),e&&Faye.Promise.defer(function(){e.call(t)})):(this.info("Handshake unsuccessful"),Faye.ENV.setTimeout(function(){i.handshake(e,t)},this._advice.interval),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._clientId),this._send({channel:Faye.Channel.CONNECT,clientId:this._clientId,connectionType:this._transport.connectionType},this._cycleConnection,this)))}},disconnect:function(){this._state===this.CONNECTED&&(this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._clientId),this._send({channel:Faye.Channel.DISCONNECT,clientId:this._clientId},function(e){e.successful&&(this._transport.close(),delete this._transport)},this),this.info("Clearing channel listeners for ?",this._clientId),this._channels=new Faye.Channel.Set)},subscribe:function(e,t,i){if(e instanceof Array)return Faye.map(e,function(e){return this.subscribe(e,t,i)},this);var n=new Faye.Subscription(this,e,t,i),s=!0===t;return this._channels.hasSubscription(e)&&!s?(this._channels.subscribe([e],t,i),n.setDeferredStatus("succeeded"),n):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._clientId,e),s||this._channels.subscribe([e],t,i),this._send({channel:Faye.Channel.SUBSCRIBE,clientId:this._clientId,subscription:e},function(s){if(!s.successful)return n.setDeferredStatus("failed",Faye.Error.parse(s.error)),this._channels.unsubscribe(e,t,i);var r=[].concat(s.subscription);this.info("Subscription acknowledged for ? to ?",this._clientId,r),n.setDeferredStatus("succeeded")},this)},this),n)},unsubscribe:function(e,t,i){if(e instanceof Array)return Faye.map(e,function(e){return this.unsubscribe(e,t,i)},this);this._channels.unsubscribe(e,t,i)&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._clientId,e),this._send({channel:Faye.Channel.UNSUBSCRIBE,clientId:this._clientId,subscription:e},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._clientId,t)}},this)},this)},publish:function(e,t){var i=new Faye.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._clientId,e,t),this._send({channel:e,data:t,clientId:this._clientId},function(e){e.successful?i.setDeferredStatus("succeeded"):i.setDeferredStatus("failed",Faye.Error.parse(e.error))},this)},this),i},receiveMessage:function(e){var t,i=e.id;e.successful!==undefined&&(t=this._responseCallbacks[i],delete this._responseCallbacks[i]),this.pipeThroughExtensions("incoming",e,null,function(e){e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),t&&t[0].call(t[1],e))},this),!0!==this._transportUp&&(this._transportUp=!0,this.trigger("transport:up"))},messageError:function(e,t){for(var i,n=this._retry,s=this,r=0,o=e.length;r<o;r++)i=e[r],i.id,t?this._transportSend(i):Faye.ENV.setTimeout(function(){s._transportSend(i)},1e3*n);t||!1===this._transportUp||(this._transportUp=!1,this.trigger("transport:down"))},_selectTransport:function(e){Faye.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,Faye.URI.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e)},this)},_send:function(e,t,i){this._transport&&(e.id=e.id||this._generateMessageId(),this.pipeThroughExtensions("outgoing",e,null,function(e){e&&(t&&(this._responseCallbacks[e.id]=[t,i]),this._transportSend(e))},this))},_transportSend:function(e){if(this._transport){var t=1.2*(this._advice.timeout||1e3*this._retry),i=new Faye.Envelope(e,t);i.errback(function(t){this.messageError([e],t)},this),this._transport.send(i)}},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_handleAdvice:function(e){Faye.extend(this._advice,e),this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&e.data!==undefined&&(this.info("Client ? calling listeners for ? with ?",this._clientId,e.channel,e.data),this._channels.distributeMessage(e))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._clientId))
;var e=this;Faye.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),Faye.extend(Faye.Client.prototype,Faye.Deferrable),Faye.extend(Faye.Client.prototype,Faye.Publisher),Faye.extend(Faye.Client.prototype,Faye.Logging),Faye.extend(Faye.Client.prototype,Faye.Extensible),Faye.Transport=Faye.extend(Faye.Class({MAX_DELAY:0,batching:!0,initialize:function(e,t){this._client=e,this.endpoint=t,this._outbox=[]},close:function(){},encode:function(){return""},send:function(e){var t=e.message;return this.debug("Client ? sending message to ?: ?",this._client._clientId,Faye.URI.stringify(this.endpoint),t),this.batching?(this._outbox.push(e),t.channel===Faye.Channel.HANDSHAKE?this.addTimeout("publish",.01,this.flush,this):(t.channel===Faye.Channel.CONNECT&&(this._connectMessage=t),this.flushLargeBatch(),void this.addTimeout("publish",this.MAX_DELAY,this.flush,this))):this.request([e])},flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),this.request(this._outbox),this._connectMessage=null,this._outbox=[]},flushLargeBatch:function(){if(!(this.encode(this._outbox).length<this._client.maxRequestSize)){var e=this._outbox.pop();this.flush(),e&&this._outbox.push(e)}},receive:function(e,t){for(var i=e.length;i--;)e[i].setDeferredStatus("succeeded");t=[].concat(t),this.debug("Client ? received from ?: ?",this._client._clientId,Faye.URI.stringify(this.endpoint),t);for(var n=0,i=t.length;n<i;n++)this._client.receiveMessage(t[n])},handleError:function(e,t){for(var i=e.length;i--;)e[i].setDeferredStatus("failed",t)},_getCookies:function(){var e=this._client.cookies;return e?e.getCookies({domain:this.endpoint.hostname,path:this.endpoint.path,secure:"https:"===this.endpoint.protocol}).toValueString():""},_storeCookies:function(e){if(e&&this._client.cookies){e=[].concat(e);for(var t,i=0,n=e.length;i<n;i++)t=this._client.cookies.setCookie(e[i]),t=t[0]||t,t.domain=t.domain||this.endpoint.hostname}}}),{get:function(e,t,i,n,s){var r=e.endpoint;Faye.asyncEach(this._transports,function(o,a){var l=o[0],c=o[1],h=e.endpoints[l]||r;return Faye.indexOf(i,l)>=0?a():Faye.indexOf(t,l)<0?(c.isUsable(e,h,function(){}),a()):void c.isUsable(e,h,function(t){if(!t)return a();var i=c.hasOwnProperty("create")?c.create(e,h):new c(e,h);n.call(s,i)})},function(){throw new Error("Could not find a usable connection type for "+Faye.URI.stringify(r))})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},_transports:[]}),Faye.extend(Faye.Transport.prototype,Faye.Logging),Faye.extend(Faye.Transport.prototype,Faye.Timeouts),Faye.Event={_registry:[],on:function(e,t,i,n){var s=function(){i.call(n)};e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s),this._registry.push({_element:e,_type:t,_callback:i,_context:n,_handler:s})},detach:function(e,t,i,n){for(var s,r=this._registry.length;r--;)s=this._registry[r],e&&e!==s._element||t&&t!==s._type||i&&i!==s._callback||n&&n!==s._context||(s._element.removeEventListener?s._element.removeEventListener(s._type,s._handler,!1):s._element.detachEvent("on"+s._type,s._handler),this._registry.splice(r,1),s=null)}},Faye.ENV.onunload!==undefined&&Faye.Event.on(Faye.ENV,"unload",Faye.Event.detach,Faye.Event),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,s,r,o,a=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(l)){for(r=l.length,i=0;i<r;i+=1)o[i]=str(i,l)||"null";return s=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,s}if(rep&&"object"==typeof rep)for(r=rep.length,i=0;i<r;i+=1)"string"==typeof rep[i]&&(n=rep[i],(s=str(n,l))&&o.push(quote(n)+(gap?": ":":")+s));else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(s=str(n,l))&&o.push(quote(n)+(gap?": ":":")+s);return s=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,s}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;Faye.stringify=function(e,t,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;n<i;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},"function"!=typeof JSON.stringify&&(JSON.stringify=Faye.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var i,n,s=e[t];if(s&&"object"==typeof s)for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n=walk(s,i),n!==undefined?s[i]=n:delete s[i]);return reviver.call(e,t,s)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Faye.Transport.WebSocket=Faye.extend(Faye.Class(Faye.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){this._pending=this._pending||new Faye.Set;for(var t=0,i=e.length;t<i;t++)this._pending.add(e[t]);this.callback(function(t){if(t){var i=Faye.map(e,function(e){return e.message});t.send(Faye.toJSON(i))}},this),this.connect()},connect:function(){if(!Faye.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=this._createSocket();if(!e)return this.setDeferredStatus("failed");var t=this;e.onopen=function(){e.headers&&t._storeCookies(e.headers["set-cookie"]),t._socket=e,t._state=t.CONNECTED,t._everConnected=!0,t._ping(),t.setDeferredStatus("succeeded",e)};var i=!1;e.onclose=e.onerror=function(){if(!i){i=!0;var n=t._state===t.CONNECTED;e.onopen=e.onclose=e.onerror=e.onmessage=null,delete t._socket,t._state=t.UNCONNECTED,t.removeTimeout("ping"),t.setDeferredStatus("unknown");var s=t._pending?t._pending.toArray():[];delete t._pending,n?t.handleError(s,!0):t._everConnected?t.handleError(s):t.setDeferredStatus("failed")}},e.onmessage=function(e){var i,n=JSON.parse(e.data),s=[];if(n){n=[].concat(n);for(var r=0,o=n.length;r<o;r++)n[r].successful!==undefined&&(i=t._pending.remove(n[r]))&&s.push(i);t.receive(s,n)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var e=Faye.Transport.WebSocket.getSocketUrl(this.endpoint),t={headers:Faye.copyObject(this._client.headers),ca:this._client.ca};return t.headers.Cookie=this._getCookies(),Faye.WebSocket?new Faye.WebSocket.Client(e,[],t):Faye.ENV.MozWebSocket?new MozWebSocket(e):Faye.ENV.WebSocket?new WebSocket(e):void 0},_ping:function(){this._socket&&(this._socket.send("[]"),this.addTimeout("ping",this._client._advice.timeout/2e3,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(e,t){var i=e.transports.websocket=e.transports.websocket||{};return i[t.href]=i[t.href]||new this(e,t),i[t.href]},getSocketUrl:function(e){return e=Faye.copyObject(e),e.protocol=this.PROTOCOLS[e.protocol],Faye.URI.stringify(e)},isUsable:function(e,t,i,n){this.create(e,t).isUsable(i,n)}}),Faye.extend(Faye.Transport.WebSocket.prototype,Faye.Deferrable),Faye.Transport.register("websocket",Faye.Transport.WebSocket),Faye.Event&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.Transport.WebSocket._unloaded=!0}),Faye.Transport.EventSource=Faye.extend(Faye.Class(Faye.Transport,{initialize:function(e,t){if(Faye.Transport.prototype.initialize.call(this,e,t),!Faye.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new Faye.Transport.XHR(e,t),t=Faye.copyObject(t),t.pathname+="/"+e._clientId;var i=new EventSource(Faye.URI.stringify(t)),n=this;i.onopen=function(){n._everConnected=!0,n.setDeferredStatus("succeeded")},i.onerror=function(){n._everConnected?n._client.messageError([]):(n.setDeferredStatus("failed"),i.close())},i.onmessage=function(e){n.receive([],JSON.parse(e.data))},this._socket=i},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)})},encode:function(e){return this._xhr.encode(e)},request:function(e){this._xhr.request(e)}}),{isUsable:function(e,t,i,n){if(!e._clientId)return i.call(n,!1);Faye.Transport.XHR.isUsable(e,t,function(s){if(!s)return i.call(n,!1);this.create(e,t).isUsable(i,n)},this)},create:function(e,t){var i=e.transports.eventsource=e.transports.eventsource||{},n=e._clientId;t=Faye.copyObject(t),t.pathname+="/"+(n||"");var s=Faye.URI.stringify(t);return i[s]=i[s]||new this(e,t),i[s]}}),Faye.extend(Faye.Transport.EventSource.prototype,Faye.Deferrable),Faye.Transport.register("eventsource",Faye.Transport.EventSource),Faye.Transport.XHR=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message});return Faye.toJSON(t)},request:function(e){var t=this.endpoint.path,i=Faye.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,n=this;i.open("POST",t,!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Pragma","no-cache"),i.setRequestHeader("X-Requested-With","XMLHttpRequest");var s=this._client.headers;for(var r in s)s.hasOwnProperty(r)&&i.setRequestHeader(r,s[r]);var o=function(){i.abort()};Faye.Event.on(Faye.ENV,"beforeunload",o),i.onreadystatechange=function(){if(i&&4===i.readyState){var t=null,s=i.status,r=i.responseText,a=s>=200&&s<300||304===s||1223===s;if(Faye.Event.detach(Faye.ENV,"beforeunload",o),i.onreadystatechange=function(){},i=null,!a)return n.handleError(e);try{t=JSON.parse(r)}catch(e){}t?n.receive(e,t):n.handleError(e)}},i.send(this.encode(e))}}),{isUsable:function(e,t,i,n){i.call(n,Faye.URI.isSameOrigin(t))}}),Faye.Transport.register("long-polling",Faye.Transport.XHR),Faye.Transport.CORS=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message});return"message="+encodeURIComponent(Faye.toJSON(t))},request:function(e){var t,i=Faye.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,n=new i,s=this._client.headers,r=this;if(n.open("POST",Faye.URI.stringify(this.endpoint),!0),n.setRequestHeader){n.setRequestHeader("Pragma","no-cache");for(t in s)s.hasOwnProperty(t)&&n.setRequestHeader(t,s[t])}var o=function(){if(!n)return!1;n.onload=n.onerror=n.ontimeout=n.onprogress=null,n=null};n.onload=function(){var t=null;try{t=JSON.parse(n.responseText)}catch(e){}o(),t?r.receive(e,t):r.handleError(e)},n.onerror=n.ontimeout=function(){o(),r.handleError(e)},n.onprogress=function(){},n.send(this.encode(e))}}),{isUsable:function(e,t,i,n){if(Faye.URI.isSameOrigin(t))return i.call(n,!1);if(Faye.ENV.XDomainRequest)return i.call(n,t.protocol===Faye.ENV.location.protocol);if(Faye.ENV.XMLHttpRequest){var s=new Faye.ENV.XMLHttpRequest;return i.call(n,s.withCredentials!==undefined)}return i.call(n,!1)}}),Faye.Transport.register("cross-origin-long-polling",Faye.Transport.CORS),Faye.Transport.JSONP=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message}),i=Faye.copyObject(this.endpoint);return i.query.message=Faye.toJSON(t),i.query.jsonp="__jsonp"+Faye.Transport.JSONP._cbCount+"__",Faye.URI.stringify(i)},request:function(e){var t=Faye.map(e,function(e){return e.message}),i=document.getElementsByTagName("head")[0],n=document.createElement("script"),s=Faye.Transport.JSONP.getCallbackName(),r=Faye.copyObject(this.endpoint),o=this;r.query.message=Faye.toJSON(t),r.query.jsonp=s,Faye.ENV[s]=function(t){if(!Faye.ENV[s])return!1;Faye.ENV[s]=undefined;try{delete Faye.ENV[s]}catch(e){}n.parentNode.removeChild(n),o.receive(e,t)},n.type="text/javascript",n.src=Faye.URI.stringify(r),i.appendChild(n)}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,i,n){i.call(n,!0)}}),Faye.Transport.register("callback-polling",Faye.Transport.JSONP)}(),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(this.deviceIsIOS&&"file"===e.type||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},FastClick.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){"use strict";var i,n;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),n=t.changedTouches[0],i=document.createEvent("MouseEvents"),i.initMouseEvent(this.determineEventType(e),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),i.forwardedTouchEvent=!0,e.dispatchEvent(i)},FastClick.prototype.determineEventType=function(e){"use strict";return this.deviceIsAndroid&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(e){"use strict";var t;this.deviceIsIOS&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){"use strict";var t,i;if(!(t=e.fastClickScrollParent)||!t.contains(e)){i=e;do{if(i.scrollHeight>i.offsetHeight){t=i,e.fastClickScrollParent=i;break}i=i.parentElement}while(i)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){"use strict";return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){"use strict";var t,i,n;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),i=e.targetTouches[0],this.deviceIsIOS){if(n=window.getSelection(),n.rangeCount&&!n.isCollapsed)return!0;if(!this.deviceIsIOS4){if(i.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=i.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=i.pageX,this.touchStartY=i.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],i=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>i||Math.abs(t.pageY-this.touchStartY)>i},FastClick.prototype.onTouchMove=function(e){"use strict";return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0)},FastClick.prototype.findControl=function(e){"use strict";return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){"use strict";var t,i,n,s,r,o=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,i=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(r=e.changedTouches[0],o=document.elementFromPoint(r.pageX-window.pageXOffset,r.pageY-window.pageYOffset)||o,o.fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(n=o.tagName.toLowerCase())){if(t=this.findControl(o)){if(this.focus(o),this.deviceIsAndroid)return!1;o=t}}else if(this.needsFocus(o))return e.timeStamp-i>100||this.deviceIsIOS&&window.top!==window&&"input"===n?(this.targetElement=null,!1):(this.focus(o),this.deviceIsIOS4&&"select"===n||(this.targetElement=null,e.preventDefault()),!1);return!(!this.deviceIsIOS||this.deviceIsIOS4||!(s=o.fastClickScrollParent)||s.fastClickLastScrollTop===s.scrollTop)||(this.needsClick(o)||(e.preventDefault(),this.sendClick(o,e)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(e){"use strict";return!this.targetElement||(!!e.forwardedTouchEvent||(!e.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1))))},FastClick.prototype.onClick=function(e){"use strict";var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail||(t=this.onMouse(e),t||(this.targetElement=null),t)},FastClick.prototype.destroy=function(){"use strict";var e=this.layer;this.deviceIsAndroid&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(e){"use strict";var t,i;if("undefined"==typeof window.ontouchstart)return!0;if(i=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!FastClick.prototype.deviceIsAndroid)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(i>31&&window.innerWidth<=window.screen.width)return!0}}return"none"===e.style.msTouchAction},FastClick.attach=function(e){"use strict";return new FastClick(e)},"undefined"!=typeof define&&define.amd?define(function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,function(e){e.fn.zclip=function(t){if("object"==typeof t&&!t.length){var i=e.extend({path:"ZeroClipboard.swf",copy:null,beforeCopy:null,afterCopy:null,clickAfter:!0,setHandCursor:!0,setCSSEffects:!0},t);return this.each(function(){var t=e(this);if(t.is(":visible")&&("string"==typeof i.copy||e.isFunction(i.copy))){ZeroClipboard.setMoviePath(i.path);var n=new ZeroClipboard.Client;e.isFunction(i.copy)&&t.bind("zClip_copy",i.copy),e.isFunction(i.beforeCopy)&&t.bind("zClip_beforeCopy",i.beforeCopy),e.isFunction(i.afterCopy)&&t.bind("zClip_afterCopy",i.afterCopy),n.setHandCursor(i.setHandCursor),n.setCSSEffects(i.setCSSEffects),n.addEventListener("mouseOver",function(){t.trigger("mouseenter")}),n.addEventListener("mouseOut",function(){t.trigger("mouseleave")}),n.addEventListener("mouseDown",function(){t.trigger("mousedown"),e.isFunction(i.copy)?n.setText(t.triggerHandler("zClip_copy")):n.setText(i.copy),e.isFunction(i.beforeCopy)&&t.trigger("zClip_beforeCopy")}),n.addEventListener("complete",function(n,s){e.isFunction(i.afterCopy)?t.trigger("zClip_afterCopy"):(s.length>500&&(s=s.substr(0,500)+"...\n\n("+(s.length-500)+" characters not shown)"),t.removeClass("hover"),alert("Copied text to clipboard:\n\n "+s)),i.clickAfter&&t.trigger("click")}),n.glue(t[0],t.parent()[0]),e(window).bind("load resize",function(){n.reposition()})}})}if("string"==typeof t)return this.each(function(){var i=e(this);t=t.toLowerCase();var n=i.data("zclipId"),s=e("#"+n+".zclip");"remove"==t?(s.remove(),i.removeClass("active hover")):"hide"==t?(s.hide(),i.removeClass("active hover")):"show"==t&&s.show()})}}(jQuery);var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){this.style.display="none"},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){for(var t=this.className.split(/\s+/),i=-1,n=0;n<t.length;n++)t[n]==e&&(i=n,n=t.length);return i>-1&&(t.splice(i,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,i){var n=this.clients[e];n&&n.receiveEvent(t,i)},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e,t){var i={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};return e&&e!=t&&(i.left+=e.offsetLeft,i.top+=e.offsetTop),i},Client:function(e){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),e&&this.glue(e)}};ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(e,t,i){this.domElement=ZeroClipboard.$(e);var n=99;this.domElement.style.zIndex&&(n=parseInt(this.domElement.style.zIndex,10)+1),"string"==typeof t?t=ZeroClipboard.$(t):void 0===t&&(t=document.getElementsByTagName("body")[0]);var s=ZeroClipboard.getDOMObjectPosition(this.domElement,t);this.div=document.createElement("div"),this.div.className="zclip",this.div.id="zclip-"+this.movieId,$(this.domElement).data("zclipId","zclip-"+this.movieId);var r=this.div.style;if(r.position="absolute",r.left=s.left+"px",r.top=s.top+"px",r.width=s.width+"px",r.height=s.height+"px",r.zIndex=n,"object"==typeof i)for(addedStyle in i)r[addedStyle]=i[addedStyle];t.appendChild(this.div),this.div.innerHTML=this.getHTML(s.width,s.height)},getHTML:function(e,t){var i="",n="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){i+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+(location.href.match(/^https/i)?"https://":"http://")+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+n+'"/><param name="wmode" value="transparent"/></object>'}else i+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+n+'" wmode="transparent" />';return i},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(e){}this.domElement=null,this.div=null}},reposition:function(e){if(e&&(this.domElement=ZeroClipboard.$(e),this.domElement||this.hide()),this.domElement&&this.div){var t=ZeroClipboard.getDOMObjectPosition(this.domElement),i=this.div.style;i.left=t.left+"px",i.top=t.top+"px"}},setText:function(e){this.clipText=e,this.ready&&this.movie.setText(e)},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){switch(e=e.toString().toLowerCase().replace(/^on/,"")){case"load":if(this.movie=document.getElementById(this.movieId),!this.movie){var i=this;return void setTimeout(function(){i.receiveEvent("load",null)},1)}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var i=this;return setTimeout(function(){i.receiveEvent("load",null)},100),void(this.ready=!0)}this.ready=!0;try{this.movie.setText(this.clipText)}catch(e){}try{this.movie.setHandCursor(this.handCursorEnabled)}catch(e){}break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var n=0,s=this.handlers[e].length;n<s;n++){var r=this.handlers[e][n];"function"==typeof r?r(this,t):"object"==typeof r&&2==r.length?r[0][r[1]](this,t):"string"==typeof r&&window[r](this,t)}}},function(e){if("function"==typeof define&&define.amd)define(e);else if("object"==typeof exports)module.exports=e();else{var t=window.Cookies,i=window.Cookies=e();i.noConflict=function(){return window.Cookies=t,i}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(i){function n(t,s,r){var o;if(arguments.length>1){if(r=e({path:"/"},n.defaults,r),"number"==typeof r.expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*r.expires),r.expires=a}try{o=JSON.stringify(s),/^[\{\[]/.test(o)&&(s=o)}catch(e){}return s=encodeURIComponent(String(s)),s=s.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",s,r.expires&&"; expires="+r.expires.toUTCString(),r.path&&"; path="+r.path,r.domain&&"; domain="+r.domain,r.secure?"; secure":""].join("")}t||(o={});for(var l=document.cookie?document.cookie.split("; "):[],c=/(%[0-9A-Z]{2})+/g,h=0;h<l.length;h++){var u=l[h].split("="),d=u[0].replace(c,decodeURIComponent),f=u.slice(1).join("=");'"'===f.charAt(0)&&(f=f.slice(1,-1));try{if(f=i&&i(f,d)||f.replace(c,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch(e){}if(t===d){o=f;break}t||(o[d]=f)}catch(e){}}return o}return n.get=n.set=n,n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,i){n(t,"",e(i,{expires:-1}))},n.withConverter=t,n}return t()}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(){var t=i(this),o=r.settings;return isNaN(t.datetime)||(0==o.cutoff||s(t.datetime)<o.cutoff)&&e(this).text(n(t.datetime)),this}function i(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:r.datetime(t)});var i=e.trim(t.text());r.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(i.length>0)||r.isTime(t)&&t.attr("title")||t.attr("title",i)}return t.data("timeago")}function n(e){return r.inWords(s(e))}function s(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return n(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):"number"==typeof t?new Date(t):e.timeago.datetime(t))};var r=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(t){function i(i,s){var r=e.isFunction(i)?i(s,t):i,o=n.numbers&&n.numbers[s]||s;return r.replace(/%d/i,o)}var n=this.settings.strings,s=n.prefixAgo,r=n.suffixAgo;this.settings.allowFuture&&t<0&&(s=n.prefixFromNow,r=n.suffixFromNow);var o=Math.abs(t)/1e3,a=o/60,l=a/60,c=l/24,h=c/365,u=o<45&&i(n.seconds,Math.round(o))||o<90&&i(n.minute,1)||a<45&&i(n.minutes,Math.round(a))||a<90&&i(n.hour,1)||l<24&&i(n.hours,Math.round(l))||l<42&&i(n.day,1)||c<30&&i(n.days,Math.round(c))||c<45&&i(n.month,1)||c<365&&i(n.months,Math.round(c/30))||h<1.5&&i(n.year,1)||i(n.years,Math.round(h)),d=n.wordSeparator||"";return n.wordSeparator===undefined&&(d=" "),e.trim([s,u,r].join(d))},parse:function(t){var i=e.trim(t);return i=i.replace(/\.\d+/,""),i=i.replace(/-/,"/").replace(/-/,"/"),i=i.replace(/T/," ").replace(/Z/," UTC"),i=i.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),i=i.replace(/([\+\-]\d\d)$/," $100"),new Date(i)},datetime:function(t){var i=r.isTime(t)?e(t).attr("datetime"):e(t).attr("title");return r.parse(i)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}});var o={init:function(){var i=e.proxy(t,this);i();var n=r.settings;n.refreshMillis>0&&(this._timeagoInterval=setInterval(i,n.refreshMillis))},update:function(i){var n=r.parse(i);e(this).data("timeago",{datetime:n}),r.settings.localeTitle&&e(this).attr("title",n.toLocaleString()),t.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:r.parse(r.isTime(this)?e(this).attr("datetime"):e(this).attr("title"))}),t.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,t){var i=e?o[e]:o.init;if(!i)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){i.call(this,t)}),this},document.createElement("abbr"),document.createElement("time")});var Handlebars=function(){var e=function(){"use strict";function e(e){this.string=e}return e.prototype.toString=function(){return""+this.string},e}(),t=function(e){"use strict";function t(e){return a[e]||"&amp;"}function i(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}function n(e){return e instanceof o?e.toString():e||0===e?(e=""+e,c.test(e)?e.replace(l,t):e):""}function s(e){return!e&&0!==e||!(!d(e)||0!==e.length)}var r={},o=e,a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},l=/[&<>"'`]/g,c=/[&<>"'`]/;r.extend=i;var h=Object.prototype.toString;r.toString=h;var u=function(e){return"function"==typeof e};u(/x/)&&(u=function(e){return"function"==typeof e&&"[object Function]"===h.call(e)});var u;r.isFunction=u;var d=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===h.call(e)};return r.isArray=d,r.escapeExpression=n,r.isEmpty=s,r}(e),i=function(){"use strict";function e(){for(var e=Error.prototype.constructor.apply(this,arguments),i=0;i<t.length;i++)this[t[i]]=e[t[i]]}var t=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=new Error,e}(),n=function(e,t){"use strict";function i(e,t){this.helpers=e||{},this.partials=t||{},n(this)}function n(e){e.registerHelper("helperMissing",function(e){
if(2===arguments.length)return undefined;throw new Error("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,i){var n=i.inverse||function(){},s=i.fn;return h(t)&&(t=t.call(this)),!0===t?s(this):!1===t||null==t?n(this):c(t)?t.length>0?e.helpers.each(t,i):n(this):s(t)}),e.registerHelper("each",function(e,t){var i,n=t.fn,s=t.inverse,r=0,o="";if(h(e)&&(e=e.call(this)),t.data&&(i=p(t.data)),e&&"object"==typeof e)if(c(e))for(var a=e.length;r<a;r++)i&&(i.index=r,i.first=0===r,i.last=r===e.length-1),o+=n(e[r],{data:i});else for(var l in e)e.hasOwnProperty(l)&&(i&&(i.key=l,i.index=r,i.first=0===r),o+=n(e[l],{data:i}),r++);return 0===r&&(o=s(this)),o}),e.registerHelper("if",function(e,t){return h(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||o.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,i){return e.helpers["if"].call(this,t,{fn:i.inverse,inverse:i.fn,hash:i.hash})}),e.registerHelper("with",function(e,t){if(h(e)&&(e=e.call(this)),!o.isEmpty(e))return t.fn(e)}),e.registerHelper("log",function(t,i){var n=i.data&&null!=i.data.level?parseInt(i.data.level,10):1;e.log(n,t)})}function s(e,t){f.log(e,t)}var r={},o=e,a=t;r.VERSION="1.2.0",r.COMPILER_REVISION=4;var l={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};r.REVISION_CHANGES=l;var c=o.isArray,h=o.isFunction,u=o.toString,d="[object Object]";r.HandlebarsEnvironment=i,i.prototype={constructor:i,logger:f,log:s,registerHelper:function(e,t,i){if(u.call(e)===d){if(i||t)throw new a("Arg not supported with multiple helpers");o.extend(this.helpers,e)}else i&&(t.not=i),this.helpers[e]=t},registerPartial:function(e,t){u.call(e)===d?o.extend(this.partials,e):this.partials[e]=t}};var f={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(f.level<=e){var i=f.methodMap[e];"undefined"!=typeof console&&console[i]&&console[i].call(console,t)}}};r.logger=f,r.log=s;var p=function(e){var t={};return o.extend(t,e),t};return r.createFrame=p,r}(t,i),s=function(e,t,i){"use strict";function n(e){var t=e&&e[0]||1,i=d;if(t!==i){if(t<i){var n=f[i],s=f[t];throw new Error("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+n+") or downgrade your runtime to an older version ("+s+").")}throw new Error("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function s(e,t){if(!t)throw new Error("No environment passed to template");var i=function(e,i,n,s,r,o){var a=t.VM.invokePartial.apply(this,arguments);if(null!=a)return a;if(t.compile){var l={helpers:s,partials:r,data:o};return r[i]=t.compile(e,{data:o!==undefined},t),r[i](n,l)}throw new u("The partial "+i+" could not be compiled when running in runtime-only mode")},n={escapeExpression:h.escapeExpression,invokePartial:i,programs:[],program:function(e,t,i){var n=this.programs[e];return i?n=o(e,t,i):n||(n=this.programs[e]=o(e,t)),n},merge:function(e,t){var i=e||t;return e&&t&&e!==t&&(i={},h.extend(i,t),h.extend(i,e)),i},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(i,s){s=s||{};var r,o,a=s.partial?s:t;s.partial||(r=s.helpers,o=s.partials);var l=e.call(n,a,i,r,o,s.data);return s.partial||t.VM.checkRevision(n.compilerInfo),l}}function r(e,t,i){var n=Array.prototype.slice.call(arguments,3),s=function(e,s){return s=s||{},t.apply(this,[e,s.data||i].concat(n))};return s.program=e,s.depth=n.length,s}function o(e,t,i){var n=function(e,n){return n=n||{},t(e,n.data||i)};return n.program=e,n.depth=0,n}function a(e,t,i,n,s,r){var o={partial:!0,helpers:n,partials:s,data:r};if(e===undefined)throw new u("The partial "+t+" could not be found");if(e instanceof Function)return e(i,o)}function l(){return""}var c={},h=e,u=t,d=i.COMPILER_REVISION,f=i.REVISION_CHANGES;return c.checkRevision=n,c.template=s,c.programWithDepth=r,c.program=o,c.invokePartial=a,c.noop=l,c}(t,i,n),r=function(e,t,i,n,s){"use strict";var r=e,o=t,a=i,l=n,c=s,h=function(){var e=new r.HandlebarsEnvironment;return l.extend(e,r),e.SafeString=o,e.Exception=a,e.Utils=l,e.VM=c,e.template=function(t){return c.template(t,e)},e},u=h();return u.create=h,u}(n,e,i,t,s),o=function(e){"use strict";var t=e,i={ProgramNode:function(e,t,n){this.type="program",this.statements=e,this.strip={},n?(this.inverse=new i.ProgramNode(n,t),this.strip.right=t.left):t&&(this.strip.left=t.right)},MustacheNode:function(e,t,i,n){if(this.type="mustache",this.hash=t,this.strip=n,null!=i&&i.charAt){var s=i.charAt(3)||i.charAt(2);this.escaped="{"!==s&&"&"!==s}else this.escaped=!!i;var r=this.id=e[0],o=this.params=e.slice(1),a=this.eligibleHelper=r.isSimple;this.isHelper=a&&(o.length||t)},PartialNode:function(e,t,i){this.type="partial",this.partialName=e,this.context=t,this.strip=i},BlockNode:function(e,i,n,s){if(e.id.original!==s.path.original)throw new t(e.id.original+" doesn't match "+s.path.original);this.type="block",this.mustache=e,this.program=i,this.inverse=n,this.strip={left:e.strip.left,right:s.strip.right},(i||n).strip.left=e.strip.right,(n||i).strip.right=s.strip.left,n&&!i&&(this.isInverse=!0)},ContentNode:function(e){this.type="content",this.string=e},HashNode:function(e){this.type="hash",this.pairs=e},IdNode:function(e){this.type="ID";for(var i="",n=[],s=0,r=0,o=e.length;r<o;r++){var a=e[r].part;if(i+=(e[r].separator||"")+a,".."===a||"."===a||"this"===a){if(n.length>0)throw new t("Invalid path: "+i);".."===a?s++:this.isScoped=!0}else n.push(a)}this.original=i,this.parts=n,this.string=n.join("."),this.depth=s,this.isSimple=1===e.length&&!this.isScoped&&0===s,this.stringModeValue=this.string},PartialNameNode:function(e){this.type="PARTIAL_NAME",this.name=e.original},DataNode:function(e){this.type="DATA",this.id=e},StringNode:function(e){this.type="STRING",this.original=this.string=this.stringModeValue=e},IntegerNode:function(e){this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)},BooleanNode:function(e){this.type="BOOLEAN",this.bool=e,this.stringModeValue="true"===e},CommentNode:function(e){this.type="comment",this.comment=e}};return i}(i),a=function(){"use strict";return function(){function e(e,t){return{left:"~"===e.charAt(2),right:"~"===t.charAt(0)||"~"===t.charAt(1)}}function t(){this.yy={}}var i={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,inMustache_repetition0:28,inMustache_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,hash:35,hash_repetition_plus0:36,hashSegment:37,ID:38,EQUALS:39,DATA:40,pathSegments:41,SEP:42,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",38:"ID",39:"EQUALS",40:"DATA",42:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[35,1],[37,3],[26,1],[26,1],[26,1],[30,2],[21,1],[41,3],[41,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[36,1],[36,2]],performAction:function(t,i,n,s,r,o){var a=o.length-1;switch(r){case 1:return new s.ProgramNode(o[a-1]);case 2:return new s.ProgramNode([]);case 3:this.$=new s.ProgramNode([],o[a-1],o[a]);break;case 4:this.$=new s.ProgramNode(o[a-2],o[a-1],o[a]);break;case 5:this.$=new s.ProgramNode(o[a-1],o[a],[]);break;case 6:this.$=new s.ProgramNode(o[a]);break;case 7:case 8:this.$=new s.ProgramNode([]);break;case 9:this.$=[o[a]];break;case 10:o[a-1].push(o[a]),this.$=o[a-1];break;case 11:this.$=new s.BlockNode(o[a-2],o[a-1].inverse,o[a-1],o[a]);break;case 12:this.$=new s.BlockNode(o[a-2],o[a-1],o[a-1].inverse,o[a]);break;case 13:case 14:this.$=o[a];break;case 15:this.$=new s.ContentNode(o[a]);break;case 16:this.$=new s.CommentNode(o[a]);break;case 17:case 18:this.$=new s.MustacheNode(o[a-1][0],o[a-1][1],o[a-2],e(o[a-2],o[a]));break;case 19:this.$={path:o[a-1],strip:e(o[a-2],o[a])};break;case 20:case 21:this.$=new s.MustacheNode(o[a-1][0],o[a-1][1],o[a-2],e(o[a-2],o[a]));break;case 22:this.$=new s.PartialNode(o[a-2],o[a-1],e(o[a-3],o[a]));break;case 23:this.$=e(o[a-1],o[a]);break;case 24:this.$=[[o[a-2]].concat(o[a-1]),o[a]];break;case 25:this.$=[[o[a]],null];break;case 26:this.$=o[a];break;case 27:this.$=new s.StringNode(o[a]);break;case 28:this.$=new s.IntegerNode(o[a]);break;case 29:this.$=new s.BooleanNode(o[a]);break;case 30:this.$=o[a];break;case 31:this.$=new s.HashNode(o[a]);break;case 32:this.$=[o[a-2],o[a]];break;case 33:this.$=new s.PartialNameNode(o[a]);break;case 34:this.$=new s.PartialNameNode(new s.StringNode(o[a]));break;case 35:this.$=new s.PartialNameNode(new s.IntegerNode(o[a]));break;case 36:this.$=new s.DataNode(o[a]);break;case 37:this.$=new s.IdNode(o[a]);break;case 38:o[a-2].push({part:o[a],separator:o[a-1]}),this.$=o[a-2];break;case 39:this.$=[{part:o[a]}];break;case 42:this.$=[];break;case 43:o[a-1].push(o[a]);break;case 46:this.$=[o[a]];break;case 47:o[a-1].push(o[a])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:29,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:30,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:31,21:24,30:25,38:[1,28],40:[1,27],41:26},{21:33,26:32,32:[1,34],33:[1,35],38:[1,28],41:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,38:[1,28],40:[1,27],41:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,42],24:[2,42],28:43,32:[2,42],33:[2,42],34:[2,42],38:[2,42],40:[2,42]},{18:[2,25],24:[2,25]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],38:[2,37],40:[2,37],42:[1,44]},{21:45,38:[1,28],41:26},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],38:[2,39],40:[2,39],42:[2,39]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,40],21:50,27:49,38:[1,28],41:26},{18:[2,33],38:[2,33]},{18:[2,34],38:[2,34]},{18:[2,35],38:[2,35]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,38:[1,28],41:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,44],21:56,24:[2,44],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:55,36:61,37:62,38:[1,63],40:[1,27],41:26},{38:[1,64]},{18:[2,36],24:[2,36],32:[2,36],33:[2,36],34:[2,36],38:[2,36],40:[2,36]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,65]},{18:[2,41]},{18:[1,66]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24]},{18:[2,43],24:[2,43],32:[2,43],33:[2,43],34:[2,43],38:[2,43],40:[2,43]},{18:[2,45],24:[2,45]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],38:[2,26],40:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],38:[2,27],40:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],38:[2,28],40:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],38:[2,29],40:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],38:[2,30],40:[2,30]},{18:[2,31],24:[2,31],37:67,38:[1,68]},{18:[2,46],24:[2,46],38:[2,46]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],38:[2,39],39:[1,69],40:[2,39],42:[2,39]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],38:[2,38],40:[2,38],42:[2,38]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{18:[2,47],24:[2,47],38:[2,47]},{39:[1,69]},{21:56,30:60,31:70,32:[1,57],33:[1,58],34:[1,59],38:[1,28],40:[1,27],41:26},{18:[2,32],24:[2,32],38:[2,32]}],defaultActions:{3:[2,2],16:[2,1],50:[2,41]},parseError:function(e){throw new Error(e)},parse:function(e){function t(){var e;return e=i.lexer.lex()||1,"number"!=typeof e&&(e=i.symbols_[e]||e),e}var i=this,n=[0],s=[null],r=[],o=this.table,a="",l=0,c=0,h=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;r.push(u);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var f,p,m,g,v,y,_,b,k,w={};;){if(m=n[n.length-1],this.defaultActions[m]?g=this.defaultActions[m]:(null!==f&&void 0!==f||(f=t()),g=o[m]&&o[m][f]),void 0===g||!g.length||!g[0]){var T="";if(!h){k=[];for(y in o[m])this.terminals_[y]&&y>2&&k.push("'"+this.terminals_[y]+"'");T=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[f]||f)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==f?"end of input":"'"+(this.terminals_[f]||f)+"'"),this.parseError(T,{text:this.lexer.match,token:this.terminals_[f]||f,line:this.lexer.yylineno,loc:u,expected:k})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+f);switch(g[0]){case 1:n.push(f),s.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(g[1]),f=null,p?(f=p,p=null):(c=this.lexer.yyleng,a=this.lexer.yytext,l=this.lexer.yylineno,u=this.lexer.yylloc,h>0&&h--);break;case 2:if(_=this.productions_[g[1]][1],w.$=s[s.length-_],w._$={first_line:r[r.length-(_||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(_||1)].first_column,last_column:r[r.length-1].last_column},d&&(w._$.range=[r[r.length-(_||1)].range[0],r[r.length-1].range[1]]),void 0!==(v=this.performAction.call(w,a,c,l,this.yy,g[1],s,r)))return v;_&&(n=n.slice(0,-1*_*2),s=s.slice(0,-1*_),r=r.slice(0,-1*_)),n.push(this.productions_[g[1]][0]),s.push(w.$),r.push(w._$),b=o[n[n.length-2]][n[n.length-1]],n.push(b);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var s=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[s[0],s[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,i,n,s;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),o=0;o<r.length&&(!(i=this._input.match(this.rules[r[o]]))||t&&!(i[0].length>t[0].length)||(t=i,n=o,this.options.flex));o++);return t?(s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[n],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,i){function n(e,i){return t.yytext=t.yytext.substr(e,t.yyleng-i)}switch(i){case 0:if("\\\\"===t.yytext.slice(-2)?(n(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(n(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return n(0,4),this.popState(),15;case 4:return 25;case 5:return 16;case 6:return 20;case 7:case 8:return 19;case 9:return 23;case 10:return 22;case 11:this.popState(),this.begin("com");break;case 12:return n(3,5),this.popState(),15;case 13:return 22;case 14:return 39;case 15:case 16:return 38;case 17:return 42;case 18:break;case 19:return this.popState(),24;case 20:return this.popState(),18;case 21:return t.yytext=n(1,2).replace(/\\"/g,'"'),32;case 22:return t.yytext=n(1,2).replace(/\\'/g,"'"),32;case 23:return 40;case 24:case 25:return 34;case 26:return 33;case 27:return 38;case 28:return t.yytext=n(1,2),38;case 29:return"INVALID";case 30:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s])))/,/^(?:false(?=([~}\s])))/,/^(?:-?[0-9]+(?=([~}\s])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,30],inclusive:!0}},e}();return i.lexer=n,t.prototype=i,i.Parser=t,new t}()}(),l=function(e,t){"use strict";function i(e){return e.constructor===r.ProgramNode?e:(s.yy=r,s.parse(e))}var n={},s=e,r=t;return n.parser=s,n.parse=i,n}(a,o),c=function(e){"use strict";function t(e){this.value=e}function i(){}var n=e.COMPILER_REVISION,s=e.REVISION_CHANGES,r=e.log;i.prototype={nameLookup:function(e,t){var n,s;return 0===e.indexOf("depth")&&(n=!0),s=/^[0-9]+$/.test(t)?e+"["+t+"]":i.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']",n?"("+e+" && "+s+")":s},compilerInfo:function(){var e=n;return"this.compilerInfo = ["+e+",'"+s[e]+"'];\n"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,i,n){this.environment=e,this.options=t||{},r("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!i,this.context=i||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t);var s,o=e.opcodes;this.i=0;for(var a=o.length;this.i<a;this.i++)s=o[this.i],"DECLARE"===s.opcode?this[s.name]=s.value:this[s.opcode].apply(this,s.args),s.opcode!==this.stripNext&&(this.stripNext=!1);return this.pushSource(""),this.createFunctionContext(n)},preamble:function(){var e=[];if(this.isChild)e.push("");else{var t=this.namespace,i="helpers = this.merge(helpers, "+t+".helpers);";this.environment.usePartial&&(i=i+" partials = this.merge(partials, "+t+".partials);"),this.options.data&&(i+=" data = data || {};"),e.push(i)}this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars.concat(this.registers.list);if(t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", ")),!this.isChild)for(var i in this.context.aliases)this.context.aliases.hasOwnProperty(i)&&(this.source[1]=this.source[1]+", "+i+"="+this.context.aliases[i]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var n=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],s=0,o=this.environment.depths.list.length;s<o;s++)n.push("depth"+this.environment.depths.list[s]);var a=this.mergeSource();if(this.isChild||(a=this.compilerInfo()+a),e)return n.push(a),Function.apply(this,n);var l="function "+(this.name||"")+"("+n.join(",")+") {\n  "+a+"}";return r("debug",l+"\n\n"),l},mergeSource:function(){for(var e,t="",i=0,n=this.source.length;i<n;i++){var s=this.source[i];s.appendToBuffer?e=e?e+"\n    + "+s.content:s.content:(e&&(t+="buffer += "+e+";\n  ",e=undefined),t+=s+"\n  ")}return t},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),e[e.length-1]="options",this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.stripNext&&(e=e.replace(/^\s+/,"")),this.pendingContent=e},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),"string"==typeof e?this.pushString(e):this.pushStackLiteral(e)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=undefined,this.options.stringParams&&(this.register("hashContexts","{"+e.contexts.join(",")+"}"),this.register("hashTypes","{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t){this.context.aliases.helperMissing="helpers.helperMissing";var i=this.lastHelper=this.setupHelper(e,t,!0),n=this.nameLookup("depth"+this.lastContext,t,"context");this.push(i.name+" || "+n),this.replaceStack(function(e){return e+" ? "+e+".call("+i.callParams+") : helperMissing.call("+i.helperMissingParams+")"})},invokeKnownHelper:function(e,t){var i=this.setupHelper(e,t);this.push(i.name+".call("+i.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var i=this.setupHelper(0,e,t),n=this.lastHelper=this.nameLookup("helpers",e,"helper"),s=this.nameLookup("depth"+this.lastContext,e,"context"),r=this.nextStack();this.pushSource("if ("+r+" = "+n+") { "+r+" = "+r+".call("+i.callParams+"); }"),this.pushSource("else { "+r+" = "+s+"; "+r+" = typeof "+r+" === functionType ? "+r+".call("+i.callParams+") : "+r+"; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t,i,n=this.popStack();this.options.stringParams&&(i=this.popStack(),t=this.popStack());var s=this.hash;t&&s.contexts.push("'"+e+"': "+t),i&&s.types.push("'"+e+"': "+i),s.values.push("'"+e+"': ("+n+")")},compiler:i,compileChildren:function(e,t){for(var i,n,s=e.children,r=0,o=s.length;r<o;r++){i=s[r],n=new this.compiler;var a=this.matchExistingProgram(i);null==a?(this.context.programs.push(""),a=this.context.programs.length,i.index=a,i.name="program"+a,this.context.programs[a]=n.compile(i,t,this.context),this.context.environments[a]=i):(i.index=a,i.name="program"+a)}},matchExistingProgram:function(e){for(var t=0,i=this.context.environments.length;t<i;t++){var n=this.context.environments[t];if(n&&n.equals(e))return t}},programExpression:function(e){if(this.context.aliases.self="this",null==e)return"self.noop";for(var t,i=this.environment.children[e],n=i.depths.list,s=[i.index,i.name,"data"],r=0,o=n.length;r<o;r++)t=n[r],1===t?s.push("depth0"):s.push("depth"+(t-1));return(0===n.length?"self.program(":"self.programWithDepth(")+s.join(", ")+")"},register:function(e,t){this.useRegister(e),this.pushSource(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new t(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=undefined),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var i,n="",s=this.isInline();if(s){var r=this.popStack(!0);if(r instanceof t)i=r.value;else{var o=this.stackSlot?this.topStackName():this.incrStack();n="("+this.push(o)+" = "+r+"),",i=this.topStack()}}else i=this.topStack();var a=e.call(this,i);return s?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+n+a+")")):(/^stack/.test(i)||(i=this.nextStack()),this.pushSource(i+" = ("+n+a+");")),i},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var i=0,n=e.length;i<n;i++){var s=e[i];s instanceof t?this.compileStack.push(s):this.pushStack(s)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var i=this.isInline(),n=(i?this.inlineStack:this.compileStack).pop();return!e&&n instanceof t?n.value:(i||this.stackSlot--,n)},topStack:function(e){var i=this.isInline()?this.inlineStack:this.compileStack,n=i[i.length-1];return!e&&n instanceof t?n.value:n},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,i){var n=[];return this.setupParams(e,n,i),{params:n,name:this.nameLookup("helpers",t,"helper"),callParams:["depth0"].concat(n).join(", "),helperMissingParams:i&&["depth0",this.quotedString(t)].concat(n).join(", ")}},setupParams:function(e,t,i){var n,s,r,o=[],a=[],l=[];o.push("hash:"+this.popStack()),s=this.popStack(),((r=this.popStack())||s)&&(r||(this.context.aliases.self="this",r="self.noop"),s||(this.context.aliases.self="this",s="self.noop"),o.push("inverse:"+s),o.push("fn:"+r));for(var c=0;c<e;c++)n=this.popStack(),t.push(n),this.options.stringParams&&(l.push(this.popStack()),a.push(this.popStack()));return this.options.stringParams&&(o.push("contexts:["+a.join(",")+"]"),o.push("types:["+l.join(",")+"]"),o.push("hashContexts:hashContexts"),o.push("hashTypes:hashTypes")),this.options.data&&o.push("data:data"),o="{"+o.join(",")+"}",i?(this.register("options",o),t.push("options")):t.push(o),t.join(", ")}};for(var o="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),a=i.RESERVED_WORDS={},l=0,c=o.length;l<c;l++)a[o[l]]=!0;return i.isValidJavaScriptVariableName=function(e){return!(i.RESERVED_WORDS[e]||!/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e))},i}(n),h=function(e,t,i,n){"use strict";function s(){}function r(e,t){if(null==e||"string"!=typeof e&&e.constructor!==u.ProgramNode)throw new l("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0)
;var i=c(e),n=(new s).compile(i,t);return(new h).compile(n,t)}function o(e,t,i){function n(){var n=c(e),r=(new s).compile(n,t),o=(new h).compile(r,t,undefined,!0);return i.template(o)}if(null==e||"string"!=typeof e&&e.constructor!==u.ProgramNode)throw new l("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in(t=t||{})||(t.data=!0);var r;return function(e,t){return r||(r=n()),r.call(this,e,t)}}var a={},l=e,c=t.parse,h=i,u=n;return a.Compiler=s,s.prototype={compiler:s,disassemble:function(){for(var e,t,i,n=this.opcodes,s=[],r=0,o=n.length;r<o;r++)if(e=n[r],"DECLARE"===e.opcode)s.push("DECLARE "+e.name+"="+e.value);else{t=[];for(var a=0;a<e.args.length;a++)i=e.args[a],"string"==typeof i&&(i='"'+i.replace("\n","\\n")+'"'),t.push(i);s.push(e.opcode+" "+t.join(" "))}return s.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var i=0;i<t;i++){var n=this.opcodes[i],s=e.opcodes[i];if(n.opcode!==s.opcode||n.args.length!==s.args.length)return!1;for(var r=0;r<n.args.length;r++)if(n.args[r]!==s.args[r])return!1}if(t=this.children.length,e.children.length!==t)return!1;for(i=0;i<t;i++)if(!this.children[i].equals(e.children[i]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t;var i=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},i)for(var n in i)this.options.knownHelpers[n]=i[n];return this.accept(e)},accept:function(e){var t,i=e.strip||{};return i.left&&this.opcode("strip"),t=this[e.type](e),i.right&&this.opcode("strip"),t},program:function(e){for(var t=e.statements,i=0,n=t.length;i<n;i++)this.accept(t[i]);return this.isSimple=1===n,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t,i=(new this.compiler).compile(e,this.options),n=this.guid++;this.usePartial=this.usePartial||i.usePartial,this.children[n]=i;for(var s=0,r=i.depths.list.length;s<r;s++)(t=i.depths.list[s])<2||this.addDepth(t-1);return n},block:function(e){var t=e.mustache,i=e.program,n=e.inverse;i&&(i=this.compileProgram(i)),n&&(n=this.compileProgram(n));var s=this.classifyMustache(t);"helper"===s?this.helperMustache(t,i,n):"simple"===s?(this.simpleMustache(t),this.opcode("pushProgram",i),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(t,i,n),this.opcode("pushProgram",i),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t,i,n=e.pairs;this.opcode("pushHash");for(var s=0,r=n.length;s<r;s++)t=n[s],i=t[1],this.options.stringParams?(i.depth&&this.addDepth(i.depth),this.opcode("getContext",i.depth||0),this.opcode("pushStringParam",i.stringModeValue,i.type)):this.accept(i),this.opcode("assignToHash",t[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.options,i=this.classifyMustache(e);"simple"===i?this.simpleMustache(e):"helper"===i?this.helperMustache(e):this.ambiguousMustache(e),e.escaped&&!t.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(e,t,i){var n=e.id,s=n.parts[0],r=null!=t||null!=i;this.opcode("getContext",n.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",i),this.opcode("invokeAmbiguous",s,r)},simpleMustache:function(e){var t=e.id;"DATA"===t.type?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(e,t,i){var n=this.setupFullMustacheParams(e,t,i),s=e.id.parts[0];if(this.options.knownHelpers[s])this.opcode("invokeKnownHelper",n.length,s);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+s);this.opcode("invokeHelper",n.length,s)}},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth),e.parts[0]?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var t=1,i=e.parts.length;t<i;t++)this.opcode("lookup",e.parts[t])},DATA:function(e){if(this.options.data=!0,e.id.isScoped||e.id.depth)throw new l("Scoped data references are not supported: "+e.original);this.opcode("lookupData");for(var t=e.id.parts,i=0,n=t.length;i<n;i++)this.opcode("lookup",t[i])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(isNaN(e))throw new Error("EWOT");0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},classifyMustache:function(e){var t=e.isHelper,i=e.eligibleHelper,n=this.options;if(i&&!t){var s=e.id.parts[0];n.knownHelpers[s]?t=!0:n.knownHelpersOnly&&(i=!1)}return t?"helper":i?"ambiguous":"simple"},pushParams:function(e){for(var t,i=e.length;i--;)t=e[i],this.options.stringParams?(t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",t.stringModeValue,t.type)):this[t.type](t)},setupMustacheParams:function(e){var t=e.params;return this.pushParams(t),e.hash?this.hash(e.hash):this.opcode("emptyHash"),t},setupFullMustacheParams:function(e,t,i){var n=e.params;return this.pushParams(n),this.opcode("pushProgram",t),this.opcode("pushProgram",i),e.hash?this.hash(e.hash):this.opcode("emptyHash"),n}},a.precompile=r,a.compile=o,a}(i,l,c,o);return function(e,t,i,n,s){"use strict";var r=e,o=t,a=i.parser,l=i.parse,c=n.Compiler,h=n.compile,u=n.precompile,d=s,f=r.create,p=function(){var e=f();return e.compile=function(t,i){return h(t,i,e)},e.precompile=u,e.AST=o,e.Compiler=c,e.JavaScriptCompiler=d,e.Parser=a,e.parse=l,e};return r=p(),r.create=p,r}(r,o,l,h,c)}();(function(){var e=this,t=e._,i={},n=Array.prototype,s=Object.prototype,r=Function.prototype,o=n.push,a=n.slice,l=n.concat,c=s.toString,h=s.hasOwnProperty,u=n.forEach,d=n.map,f=n.reduce,p=n.reduceRight,m=n.filter,g=n.every,v=n.some,y=n.indexOf,_=n.lastIndexOf,b=Array.isArray,k=Object.keys,w=r.bind,T=function(e){return e instanceof T?e:this instanceof T?void(this._wrapped=e):new T(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.5.2";var C=T.each=T.forEach=function(e,t,n){if(null!=e)if(u&&e.forEach===u)e.forEach(t,n);else if(e.length===+e.length){for(var s=0,r=e.length;s<r;s++)if(t.call(n,e[s],s,e)===i)return}else for(var o=T.keys(e),s=0,r=o.length;s<r;s++)if(t.call(n,e[o[s]],o[s],e)===i)return};T.map=T.collect=function(e,t,i){var n=[];return null==e?n:d&&e.map===d?e.map(t,i):(C(e,function(e,s,r){n.push(t.call(i,e,s,r))}),n)};var E="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(e,t,i,n){var s=arguments.length>2;if(null==e&&(e=[]),f&&e.reduce===f)return n&&(t=T.bind(t,n)),s?e.reduce(t,i):e.reduce(t);if(C(e,function(e,r,o){s?i=t.call(n,i,e,r,o):(i=e,s=!0)}),!s)throw new TypeError(E);return i},T.reduceRight=T.foldr=function(e,t,i,n){var s=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return n&&(t=T.bind(t,n)),s?e.reduceRight(t,i):e.reduceRight(t);var r=e.length;if(r!==+r){var o=T.keys(e);r=o.length}if(C(e,function(a,l,c){l=o?o[--r]:--r,s?i=t.call(n,i,e[l],l,c):(i=e[l],s=!0)}),!s)throw new TypeError(E);return i},T.find=T.detect=function(e,t,i){var n;return S(e,function(e,s,r){if(t.call(i,e,s,r))return n=e,!0}),n},T.filter=T.select=function(e,t,i){var n=[];return null==e?n:m&&e.filter===m?e.filter(t,i):(C(e,function(e,s,r){t.call(i,e,s,r)&&n.push(e)}),n)},T.reject=function(e,t,i){return T.filter(e,function(e,n,s){return!t.call(i,e,n,s)},i)},T.every=T.all=function(e,t,n){t||(t=T.identity);var s=!0;return null==e?s:g&&e.every===g?e.every(t,n):(C(e,function(e,r,o){if(!(s=s&&t.call(n,e,r,o)))return i}),!!s)};var S=T.some=T.any=function(e,t,n){t||(t=T.identity);var s=!1;return null==e?s:v&&e.some===v?e.some(t,n):(C(e,function(e,r,o){if(s||(s=t.call(n,e,r,o)))return i}),!!s)};T.contains=T.include=function(e,t){return null!=e&&(y&&e.indexOf===y?-1!=e.indexOf(t):S(e,function(e){return e===t}))},T.invoke=function(e,t){var i=a.call(arguments,2),n=T.isFunction(t);return T.map(e,function(e){return(n?t:e[t]).apply(e,i)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t,i){return T.isEmpty(t)?i?void 0:[]:T[i?"find":"filter"](e,function(e){for(var i in t)if(t[i]!==e[i])return!1;return!0})},T.findWhere=function(e,t){return T.where(e,t,!0)},T.max=function(e,t,i){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-Infinity;var n={computed:-Infinity,value:-Infinity};return C(e,function(e,s,r){var o=t?t.call(i,e,s,r):e;o>n.computed&&(n={value:e,computed:o})}),n.value},T.min=function(e,t,i){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return Infinity;var n={computed:Infinity,value:Infinity};return C(e,function(e,s,r){var o=t?t.call(i,e,s,r):e;o<n.computed&&(n={value:e,computed:o})}),n.value},T.shuffle=function(e){var t,i=0,n=[];return C(e,function(e){t=T.random(i++),n[i-1]=n[t],n[t]=e}),n},T.sample=function(e,t,i){return arguments.length<2||i?e[T.random(e.length-1)]:T.shuffle(e).slice(0,Math.max(0,t))};var x=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,i){var n=x(t);return T.pluck(T.map(e,function(e,t,s){return{value:e,index:t,criteria:n.call(i,e,t,s)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index}),"value")};var N=function(e){return function(t,i,n){var s={},r=null==i?T.identity:x(i);return C(t,function(i,o){var a=r.call(n,i,o,t);e(s,a,i)}),s}};T.groupBy=N(function(e,t,i){(T.has(e,t)?e[t]:e[t]=[]).push(i)}),T.indexBy=N(function(e,t,i){e[t]=i}),T.countBy=N(function(e,t){T.has(e,t)?e[t]++:e[t]=1}),T.sortedIndex=function(e,t,i,n){i=null==i?T.identity:x(i);for(var s=i.call(n,t),r=0,o=e.length;r<o;){var a=r+o>>>1;i.call(n,e[a])<s?r=a+1:o=a}return r},T.toArray=function(e){return e?T.isArray(e)?a.call(e):e.length===+e.length?T.map(e,T.identity):T.values(e):[]},T.size=function(e){return null==e?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,i){if(null!=e)return null==t||i?e[0]:a.call(e,0,t)},T.initial=function(e,t,i){return a.call(e,0,e.length-(null==t||i?1:t))},T.last=function(e,t,i){if(null!=e)return null==t||i?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},T.rest=T.tail=T.drop=function(e,t,i){return a.call(e,null==t||i?1:t)},T.compact=function(e){return T.filter(e,T.identity)};var F=function(e,t,i){return t&&T.every(e,T.isArray)?l.apply(i,e):(C(e,function(e){T.isArray(e)||T.isArguments(e)?t?o.apply(i,e):F(e,t,i):i.push(e)}),i)};T.flatten=function(e,t){return F(e,t,[])},T.without=function(e){return T.difference(e,a.call(arguments,1))},T.uniq=T.unique=function(e,t,i,n){T.isFunction(t)&&(n=i,i=t,t=!1);var s=i?T.map(e,i,n):e,r=[],o=[];return C(s,function(i,n){(t?n&&o[o.length-1]===i:T.contains(o,i))||(o.push(i),r.push(e[n]))}),r},T.union=function(){return T.uniq(T.flatten(arguments,!0))},T.intersection=function(e){var t=a.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=l.apply(n,a.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){for(var e=T.max(T.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;i<e;i++)t[i]=T.pluck(arguments,""+i);return t},T.object=function(e,t){if(null==e)return{};for(var i={},n=0,s=e.length;n<s;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},T.indexOf=function(e,t,i){if(null==e)return-1;var n=0,s=e.length;if(i){if("number"!=typeof i)return n=T.sortedIndex(e,t),e[n]===t?n:-1;n=i<0?Math.max(0,s+i):i}if(y&&e.indexOf===y)return e.indexOf(t,i);for(;n<s;n++)if(e[n]===t)return n;return-1},T.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(_&&e.lastIndexOf===_)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var s=n?i:e.length;s--;)if(e[s]===t)return s;return-1},T.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),s=0,r=new Array(n);s<n;)r[s++]=e,e+=i;return r};var $=function(){};T.bind=function(e,t){var i,n;if(w&&e.bind===w)return w.apply(e,a.call(arguments,1));if(!T.isFunction(e))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(a.call(arguments)));$.prototype=e.prototype;var s=new $;$.prototype=null;var r=e.apply(s,i.concat(a.call(arguments)));return Object(r)===r?r:s}},T.partial=function(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}},T.bindAll=function(e){var t=a.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return C(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var i={};return t||(t=T.identity),function(){var n=t.apply(this,arguments);return T.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},T.delay=function(e,t){var i=a.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(a.call(arguments,1)))},T.throttle=function(e,t,i){var n,s,r,o=null,a=0;i||(i={});var l=function(){a=!1===i.leading?0:new Date,o=null,r=e.apply(n,s)};return function(){var c=new Date;a||!1!==i.leading||(a=c);var h=t-(c-a);return n=this,s=arguments,h<=0?(clearTimeout(o),o=null,a=c,r=e.apply(n,s)):o||!1===i.trailing||(o=setTimeout(l,h)),r}},T.debounce=function(e,t,i){var n,s,r,o,a;return function(){r=this,s=arguments,o=new Date;var l=function(){var c=new Date-o;c<t?n=setTimeout(l,t-c):(n=null,i||(a=e.apply(r,s)))},c=i&&!n;return n||(n=setTimeout(l,t)),c&&(a=e.apply(r,s)),a}},T.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},T.wrap=function(e,t){return function(){var i=[e];return o.apply(i,arguments),t.apply(this,i)}},T.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},T.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},T.keys=k||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)T.has(e,i)&&t.push(i);return t},T.values=function(e){for(var t=T.keys(e),i=t.length,n=new Array(i),s=0;s<i;s++)n[s]=e[t[s]];return n},T.pairs=function(e){for(var t=T.keys(e),i=t.length,n=new Array(i),s=0;s<i;s++)n[s]=[t[s],e[t[s]]];return n},T.invert=function(e){for(var t={},i=T.keys(e),n=0,s=i.length;n<s;n++)t[e[i[n]]]=i[n];return t},T.functions=T.methods=function(e){var t=[];for(var i in e)T.isFunction(e[i])&&t.push(i);return t.sort()},T.extend=function(e){return C(a.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},T.pick=function(e){var t={},i=l.apply(n,a.call(arguments,1));return C(i,function(i){i in e&&(t[i]=e[i])}),t},T.omit=function(e){var t={},i=l.apply(n,a.call(arguments,1));for(var s in e)T.contains(i,s)||(t[s]=e[s]);return t},T.defaults=function(e){return C(a.call(arguments,1),function(t){if(t)for(var i in t)void 0===e[i]&&(e[i]=t[i])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var I=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var s=c.call(e);if(s!=c.call(t))return!1;switch(s){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var r=i.length;r--;)if(i[r]==e)return n[r]==t;var o=e.constructor,a=t.constructor;if(o!==a&&!(T.isFunction(o)&&o instanceof o&&T.isFunction(a)&&a instanceof a))return!1;i.push(e),n.push(t);var l=0,h=!0;if("[object Array]"==s){if(l=e.length,h=l==t.length)for(;l--&&(h=I(e[l],t[l],i,n)););}else{for(var u in e)if(T.has(e,u)&&(l++,!(h=T.has(t,u)&&I(e[u],t[u],i,n))))break;if(h){for(u in t)if(T.has(t,u)&&!l--)break;h=!l}}return i.pop(),n.pop(),h};T.isEqual=function(e,t){return I(e,t,[],[])},T.isEmpty=function(e){if(null==e)return!0;if(T.isArray(e)||T.isString(e))return 0===e.length;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!(!e||1!==e.nodeType)},T.isArray=b||function(e){return"[object Array]"==c.call(e)},T.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!(!e||!T.has(e,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(e){return"function"==typeof e}),T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==c.call(e)},T.isNull=function(e){return null===e},T.isUndefined=function(e){return void 0===e},T.has=function(e,t){return h.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.times=function(e,t,i){for(var n=Array(Math.max(0,e)),s=0;s<e;s++)n[s]=t.call(i,s);return n},T.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};O.unescape=T.invert(O.escape);var A={escape:new RegExp("["+T.keys(O.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(O.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return null==t?"":(""+t).replace(A[e],function(t){return O[e][t]})}}),T.result=function(e,t){if(null!=e){var i=e[t];return T.isFunction(i)?i.call(e):i}},T.mixin=function(e){C(T.functions(e),function(t){var i=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,i.apply(T,e))}})};var V=0;T.uniqueId=function(e){var t=++V+"";return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,i){var n;i=T.defaults({},i,T.templateSettings);var s=new RegExp([(i.escape||M).source,(i.interpolate||M).source,(i.evaluate||M).source].join("|")+"|$","g"),r=0,o="__p+='";e.replace(s,function(t,i,n,s,a){return o+=e.slice(r,a).replace(D,function(e){return"\\"+P[e]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),s&&(o+="';\n"+s+"\n__p+='"),r=a+t.length,t}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(e){throw e.source=o,e}if(t)return n(t,T);var a=function(e){return n.call(this,e,T)};return a.source="function("+(i.variable||"obj")+"){\n"+o+"}",a},T.chain=function(e){return T(e).chain()};var j=function(e){return this._chain?T(e).chain():e};T.mixin(T),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];T.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],j.call(this,i)}}),C(["concat","join","slice"],function(e){var t=n[e];T.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(){var e,t=this,i=t.Backbone,n=[],s=(n.push,n.slice);n.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="1.1.0";var r=t._;r||"undefined"==typeof require||(r=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender||t.$,e.noConflict=function(){return t.Backbone=i,this},e.emulateHTTP=!1,e.emulateJSON=!1;var o=e.Events={on:function(e,t,i){return l(this,"on",e,[t,i])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this}),this):this},once:function(e,t,i){if(!l(this,"once",e,[t,i])||!t)return this;var n=this,s=r.once(function(){n.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,i)},off:function(e,t,i){var n,s,o,a,c,h,u,d;if(!this._events||!l(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events={},this;for(a=e?[e]:r.keys(this._events),c=0,h=a.length;c<h;c++)if(e=a[c],o=this._events[e]){if(this._events[e]=n=[],t||i)for(u=0,d=o.length;u<d;u++)s=o[u],(t&&t!==s.callback&&t!==s.callback._callback||i&&i!==s.context)&&n.push(s);n.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=s.call(arguments,1);if(!l(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&c(i,t),n&&c(n,arguments),this},stopListening:function(e,t,i){var n=this._listeningTo;if(!n)return this;var s=!t&&!i;i||"object"!=typeof t||(i=this),e&&((n={})[e._listenId]=e);for(var o in n)e=n[o],e.off(t,i,this),(s||r.isEmpty(e._events))&&delete this._listeningTo[o];return this}},a=/\s+/,l=function(e,t,i,n){if(!i)return!0;if("object"==typeof i){for(var s in i)e[t].apply(e,[s,i[s]].concat(n));return!1}if(a.test(i)){for(var r=i.split(a),o=0,l=r.length;o<l;o++)e[t].apply(e,[r[o]].concat(n));return!1}return!0},c=function(e,t){var i,n=-1,s=e.length,r=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++n<s;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r,o);return;case 3:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r,o,a);return;default:for(;++n<s;)(i=e[n]).callback.apply(i.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};r.each(h,function(e,t){o[t]=function(t,i,n){return(this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=r.uniqueId("l"))]=t,n||"object"!=typeof i||(n=this),t[e](i,n,this),this}}),o.bind=o.on,o.unbind=o.off,r.extend(e,o);var u=e.Model=function(e,t){var i=e||{};t||(t={}),this.cid=r.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{}),i=r.defaults({},i,r.result(this,"defaults")),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};r.extend(u.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return r.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return r.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var n,s,o,a,l,c,h,u;if(null==e)return this;if("object"==typeof e?(s=e,i=t):(s={})[e]=t,i||(i={}),!this._validate(s,i))return!1;o=i.unset,l=i.silent,a=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=r.clone(this.attributes),this.changed={}),u=this.attributes,h=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(n in s)t=s[n],r.isEqual(u[n],t)||a.push(n),r.isEqual(h[n],t)?delete this.changed[n]:this.changed[n]=t,o?delete u[n]:u[n]=t;if(!l){a.length&&(this._pending=!0);for(var d=0,f=a.length;d<f;d++)this.trigger("change:"+a[d],this,u[a[d]],i)}if(c)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,r.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,r.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!r.isEmpty(this.changed):r.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&r.clone(this.changed);var t,i=!1,n=this._changing?this._previousAttributes:this.attributes;for(var s in e)r.isEqual(n[s],t=e[s])||((i||(i={}))[s]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return r.clone(this._previousAttributes)},fetch:function(e){e=e?r.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,i=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;i&&i(t,n,e),t.trigger("sync",t,n,e)},P(this,e),this.sync("read",this,e)},save:function(e,t,i){var n,s,o,a=this.attributes;if(null==e||"object"==typeof e?(n=e,i=t):(n={})[e]=t,i=r.extend({validate:!0},i),n&&!i.wait){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=r.extend({},a,n)),void 0===i.parse&&(i.parse=!0);var l=this,c=i.success;return i.success=function(e){l.attributes=a;var t=l.parse(e,i);if(i.wait&&(t=r.extend(n||{},t)),r.isObject(t)&&!l.set(t,i))return!1;c&&c(l,e,i),l.trigger("sync",l,e,i)},P(this,i),s=this.isNew()?"create":i.patch?"patch":"update","patch"===s&&(i.attrs=n),o=this.sync(s,this,i),n&&i.wait&&(this.attributes=a),o},destroy:function(e){e=e?r.clone(e):{};var t=this,i=e.success,n=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(s){(e.wait||t.isNew())&&n(),i&&i(t,s,e),t.isNew()||t.trigger("sync",t,s,e)},this.isNew())return e.success(),!1;P(this,e);var s=this.sync("delete",this,e);return e.wait||n(),s},url:function(){var e=r.result(this,"urlRoot")||r.result(this.collection,"url")||M();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},r.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=r.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,r.extend(t,{validationError:i})),!1)}});var d=["keys","values","pairs","invert","pick","omit"];r.each(d,function(e){u.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.attributes),r[e].apply(r,t)}});var f=e.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,r.extend({silent:!0},t))},p={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};r.extend(f.prototype,o,{model:u,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,t){return this.set(e,r.extend({merge:!1},t,m))},remove:function(e,t){var i=!r.isArray(e);e=i?[e]:r.clone(e),t||(t={});var n,s,o,a;for(n=0,s=e.length;n<s;n++)(a=e[n]=this.get(e[n]))&&(delete this._byId[a.id],delete this._byId[a.cid],o=this.indexOf(a),this.models.splice(o,1),this.length--,t.silent||(t.index=o,a.trigger("remove",a,this,t)),this._removeReference(a));return i?e[0]:e},set:function(e,t){t=r.defaults({},t,p),t.parse&&(e=this.parse(e,t));var i=!r.isArray(e);e=i?e?[e]:[]:r.clone(e);var n,s,o,a,l,c,h,d=t.at,f=this.model,m=this.comparator&&null==d&&!1!==t.sort,g=r.isString(this.comparator)?this.comparator:null,v=[],y=[],_={},b=t.add,k=t.merge,w=t.remove,T=!(m||!b||!w)&&[];for(n=0,s=e.length;n<s;n++){if(l=e[n],o=l instanceof u?a=l:l[f.prototype.idAttribute],c=this.get(o))w&&(_[c.cid]=!0),k&&(l=l===a?a.attributes:l,t.parse&&(l=c.parse(l,t)),c.set(l,t),m&&!h&&c.hasChanged(g)&&(h=!0)),e[n]=c;else if(b){if(!(a=e[n]=this._prepareModel(l,t)))continue;v.push(a),a.on("all",this._onModelEvent,this),this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a)}T&&T.push(c||a)}if(w){for(n=0,s=this.length;n<s;++n)_[(a=this.models[n]).cid]||y.push(a);y.length&&this.remove(y,t)}if(v.length||T&&T.length)if(m&&(h=!0),this.length+=v.length,null!=d)for(n=0,s=v.length;n<s;n++)this.models.splice(d+n,0,v[n]);else{T&&(this.models.length=0);var C=T||v;for(n=0,s=C.length;n<s;n++)this.models.push(C[n])}if(h&&this.sort({silent:!0}),!t.silent){for(n=0,s=v.length;n<s;n++)(a=v[n]).trigger("add",a,this,t);(h||T&&T.length)&&this.trigger("sort",this,t)}return i?e[0]:e},reset:function(e,t){t||(t={});for(var i=0,n=this.models.length;i<n;i++)this._removeReference(this.models[i]);return t.previousModels=this.models,this._reset(),e=this.add(e,r.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,r.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,r.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return r.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),r.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(r.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return r.invoke(this.models,"get",e)},fetch:function(e){e=e?r.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,i=this;return e.success=function(n){var s=e.reset?"reset":"set";i[s](n,e),t&&t(i,n,e),i.trigger("sync",i,n,e)},P(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?r.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,n=t.success;return t.success=function(e,t,s){s.wait&&i.add(e,s),n&&n(e,t,s)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof u)return e.collection||(e.collection=this),e;t=t?r.clone(t):{},t.collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var g=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];r.each(g,function(e){f.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.models),r[e].apply(r,t)}});var v=["groupBy","countBy","sortBy"];r.each(v,function(e){f.prototype[e]=function(t,i){var n=r.isFunction(t)?t:function(e){return e.get(t)};return r[e](this.models,n,i)}});var y=e.View=function(e){this.cid=r.uniqueId("view"),e||(e={}),r.extend(this,r.pick(e,b)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,b=["model","collection","el","id","attributes","className","tagName","events"];r.extend(y.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,i){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=r.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var i=e[t];if(r.isFunction(i)||(i=this[e[t]]),i){var n=t.match(_),s=n[1],o=n[2];i=r.bind(i,this),s+=".delegateEvents"+this.cid,""===o?this.$el.on(s,i):this.$el.on(s,o,i)}}return this},undelegateEvents:function(){
return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(r.result(this,"el"),!1);else{var t=r.extend({},r.result(this,"attributes"));this.id&&(t.id=r.result(this,"id")),this.className&&(t["class"]=r.result(this,"className"));var i=e.$("<"+r.result(this,"tagName")+">").attr(t);this.setElement(i,!1)}}}),e.sync=function(t,i,n){var s=w[t];r.defaults(n||(n={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var o={type:s,dataType:"json"};if(n.url||(o.url=r.result(i,"url")||M()),null!=n.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),n.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",n.emulateJSON&&(o.data._method=s);var a=n.beforeSend;n.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",s),a)return a.apply(this,arguments)}}"GET"===o.type||n.emulateJSON||(o.processData=!1),"PATCH"===o.type&&k&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=n.xhr=e.ajax(r.extend(o,n));return i.trigger("request",i,l,n),l};var k=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),w={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var T=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,E=/(\(\?)?:\w+/g,S=/\*\w+/g,x=/[\-{}\[\]+?.,\\\^$|#\s]/g;r.extend(T.prototype,o,{initialize:function(){},route:function(t,i,n){r.isRegExp(t)||(t=this._routeToRegExp(t)),r.isFunction(i)&&(n=i,i=""),n||(n=this[i]);var s=this;return e.history.route(t,function(r){var o=s._extractParameters(t,r);n&&n.apply(s,o),s.trigger.apply(s,["route:"+i].concat(o)),s.trigger("route",i,o),e.history.trigger("route",s,i,o)}),this},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=r.result(this,"routes");for(var e,t=r.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(x,"\\$&").replace(C,"(?:$1)?").replace(E,function(e,t){return t?e:"([^/]+)"}).replace(S,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return r.map(i,function(e){return e?decodeURIComponent(e):null})}});var N=e.History=function(){this.handlers=[],r.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,$=/^\/+|\/+$/g,I=/msie [\w.]+/,O=/\/$/,A=/[?#].*$/;N.started=!1,r.extend(N.prototype,o,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var i=this.root.replace(O,"");e.indexOf(i)||(e=e.slice(i.length))}else e=this.getHash();return e.replace(F,"")},start:function(t){if(N.started)throw new Error("Backbone.history has already been started");N.started=!0,this.options=r.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),n=document.documentMode,s=I.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace($,"/"),s&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(i)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!a)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),N.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),r.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!N.started)return!1;t&&!0!==t||(t={trigger:!!t});var i=this.root+(e=this.getFragment(e||""));if(e=e.replace(A,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),e.history=new N;var V=function(e,t){var i,n=this;i=e&&r.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},r.extend(i,n,t);var s=function(){this.constructor=i};return s.prototype=n.prototype,i.prototype=new s,e&&r.extend(i.prototype,e),i.__super__=n.prototype,i};u.extend=f.extend=T.extend=y.extend=N.extend=V;var M=function(){throw new Error('A "url" property or function must be specified')},P=function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}}}.call(this),function(){var e={},t=null,i=null,n=document.title,s=null,r=null,o={},a=window.devicePixelRatio||1,l=16*a,c={width:7,height:9,font:10*a+"px arial",colour:"#ffffff",background:"#F03D25",fallback:!0,crossOrigin:!0,abbreviate:!0},h=function(){var e=navigator.userAgent.toLowerCase();return function(t){return-1!==e.indexOf(t)}}(),u={ie:h("msie"),chrome:h("chrome"),webkit:h("chrome")||h("safari"),safari:h("safari")&&!h("chrome"),mozilla:h("mozilla")&&!h("chrome")&&!h("safari")},d=function(){for(var e=document.getElementsByTagName("link"),t=0,i=e.length;t<i;t++)if((e[t].getAttribute("rel")||"").match(/\bicon\b/))return e[t];return!1},f=function(){for(var e=document.getElementsByTagName("link"),t=document.getElementsByTagName("head")[0],i=0,n=e.length;i<n;i++){"undefined"!=typeof e[i]&&(e[i].getAttribute("rel")||"").match(/\bicon\b/)&&t.removeChild(e[i])}},p=function(){if(!i||!t){var e=d();i=t=e?e.getAttribute("href"):"/favicon.ico"}return t},m=function(){return r||(r=document.createElement("canvas"),r.width=l,r.height=l),r},g=function(e){f();var t=document.createElement("link");t.type="image/x-icon",t.rel="icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)},v=function(e,t){if(!m().getContext||u.ie||u.safari||"force"===o.fallback)return y(e);var i=m().getContext("2d"),t=t||"#000000",n=p();s=document.createElement("img"),s.onload=function(){i.clearRect(0,0,l,l),i.drawImage(s,0,0,s.width,s.height,0,0,l,l),(e+"").length>0&&_(i,e,t),b()},!n.match(/^data/)&&o.crossOrigin&&(s.crossOrigin="anonymous"),s.src=n},y=function(e){o.fallback&&((e+"").length>0?document.title="("+e+") "+n:document.title=n)},_=function(e,t){"number"==typeof t&&t>99&&o.abbreviate&&(t=k(t));var i=(t+"").length-1,n=o.width*a+6*a*i,s=o.height*a,r=l-s,c=l-n-a,h=16*a,d=16*a,f=2*a;e.font=(u.webkit?"bold ":"")+o.font,e.fillStyle=o.background,e.strokeStyle=o.background,e.lineWidth=a,e.beginPath(),e.moveTo(c+f,r),e.quadraticCurveTo(c,r,c,r+f),e.lineTo(c,h-f),e.quadraticCurveTo(c,h,c+f,h),e.lineTo(d-f,h),e.quadraticCurveTo(d,h,d,h-f),e.lineTo(d,r+f),e.quadraticCurveTo(d,r,d-f,r),e.closePath(),e.fill(),e.beginPath(),e.strokeStyle="rgba(0,0,0,0.3)",e.moveTo(c+f/2,h),e.lineTo(d-f/2,h),e.stroke(),e.fillStyle=o.colour,e.textAlign="right",e.textBaseline="top",e.fillText(t,2===a?29:15,u.mozilla?7*a:6*a)},b=function(){m().getContext&&g(m().toDataURL())},k=function(e){for(var t=[["G",1e9],["M",1e6],["k",1e3]],i=0;i<t.length;++i)if(e>=t[i][1]){e=w(e/t[i][1])+t[i][0];break}return e},w=function(e,t){return new Number(e).toFixed(t)};e.setOptions=function(e){o={};for(var t in c)o[t]=e.hasOwnProperty(t)?e[t]:c[t];return this},e.setImage=function(e){return t=e,b(),this},e.setBubble=function(e,t){return e=e||"",v(e,t),this},e.reset=function(){g(i)},e.setOptions(c),window.Tinycon=e}(),function(e){function t(t,i){var n;return e.Notification?n=new e.Notification(t,{icon:y(i.icon)?i.icon:i.icon.x32,body:i.body||p,tag:i.tag||p}):e.webkitNotifications?(n=e.webkitNotifications.createNotification(i.icon,t,i.body),n.show()):navigator.mozNotification?(n=navigator.mozNotification.createNotification(t,i.body,i.icon),n.show()):e.external&&e.external.msIsSiteMode()&&(e.external.msSiteModeClearIconOverlay(),e.external.msSiteModeSetIconOverlay(y(i.icon)?i.icon:i.icon.x16,t),e.external.msSiteModeActivate(),n={ieVerification:g+1}),n}function i(t){return{close:function(){t&&(t.close?t.close():e.external&&e.external.msIsSiteMode()&&t.ieVerification===g&&e.external.msSiteModeClearIconOverlay())}}}function n(t){if(m){var i=v(t)?t:k;e.webkitNotifications&&e.webkitNotifications.checkPermission?e.webkitNotifications.requestPermission(i):e.Notification&&e.Notification.requestPermission&&e.Notification.requestPermission(i)}}function s(){var t;if(m)return e.Notification&&e.Notification.permissionLevel?t=e.Notification.permissionLevel():e.webkitNotifications&&e.webkitNotifications.checkPermission?t=u[e.webkitNotifications.checkPermission()]:navigator.mozNotification?t=c:e.Notification&&e.Notification.permission?t=e.Notification.permission:e.external&&e.external.msIsSiteMode()!==undefined&&(t=e.external.msIsSiteMode()?c:l),t}function r(e){return e&&_(e)&&b(w,e),w}function o(){return!w.pageVisibility||(document.hidden||document.msHidden||document.mozHidden||document.webkitHidden)}function a(n,r){var a,l;return m&&o()&&y(n)&&r&&(y(r.icon)||_(r.icon))&&s()===c&&(a=t(n,r)),l=i(a),w.autoClose&&a&&!a.ieVerification&&a.addEventListener&&a.addEventListener("show",function(){var t=l;e.setTimeout(function(){t.close()},w.autoClose)}),l}var l="default",c="granted",h="denied",u=[c,l,h],d={pageVisibility:!1,autoClose:0},f={},p="",m=function(){var t=!1;try{t=!!(e.Notification||e.webkitNotifications||navigator.mozNotification||e.external&&e.external.msIsSiteMode()!==undefined)}catch(e){}return t}(),g=Math.floor(10*Math.random()+1),v=function(e){return e&&e.constructor===Function},y=function(e){return e&&e.constructor===String},_=function(e){return e&&e.constructor===Object},b=function(e,t){var i,n;for(i in t)n=t[i],i in e&&(e[i]===n||i in f&&f[i]===n)||(e[i]=n);return e},k=function(){},w=d;e.notify={PERMISSION_DEFAULT:l,PERMISSION_GRANTED:c,PERMISSION_DENIED:h,isSupported:m,config:r,createNotification:a,permissionLevel:s,requestPermission:n},v(Object.seal)&&Object.seal(e.notify)}(window);var Talkio={Classes:{},Models:{Stats:{}},Collections:{},Views:{Widgets:{}},Routers:{},Variables:{Stats:{},Widgets:{}},Paths:{},Templates:{}};$('script[type="text/x-handlebars-template"]').each(function(){var e=$(this);Talkio.Templates[e.attr("id").replace("-template","").replace("-","_")]=Handlebars.compile(e.html())}),Talkio.Classes.AsidePanel=Backbone.View.extend({hide:function(){this.$el.removeClass("show")},toggle:function(){this.$el.hasClass("show")?(this.onHide(),$(document).off("click",_.bind(this.hideOnBlur,this))):(this.onShow(),$(document).on("click",_.bind(this.hideOnBlur,this))),this.$el.toggleClass("show")},hideOnBlur:function(e){0==this.$el.find(e.target).length&&(this.$el.removeClass("show"),$(document).off(e))},onShow:function(){},onHide:function(){}}),Talkio.Models.Channel=Backbone.Model.extend({idAttribute:"permalink"}),Talkio.Models.ChannelSettings=Backbone.Model.extend({urlRoot:"/api/chats",historyTTL:function(){return this.get("history_ttl")},isAllowed:function(e){return this.get("allow_anonymous")||!e.isAnonymous()},allowAnonymous:function(){return this.get("allow_anonymous")},toggleAllowAnonymous:function(){this.set("allow_anonymous",!this.get("allow_anonymous")),this.save()},toJSON:function(){return{chat:_.clone(this.attributes)}}}),Talkio.Models.CurrentUser=Backbone.Model.extend({idAttribute:"token",urlRoot:function(){return Talkio.Paths.participant},_typing:!1,owner:!1,inactive_since:null,initialize:function(){this.listenTo(Talkio.Variables.channel_settings,"change:allow_anonymous",this.checkIfAllowed),this.on("sync",this.signIn,this)},join:function(){Talkio.Variables.socket.publishPrivateMessage("join",{token:this.id})},authenticate:function(){Talkio.Variables.socket.publishPrivateMessage("authenticate",{token:this.id}),this.trigger("currentUserChanged")},deauthenticate:function(){Talkio.Variables.socket.publishPrivateMessage("deauthenticate"),this.trigger("currentUserChanged")},isSignedIn:function(){return!this.isNew()&&Talkio.Variables.channel_settings.isAllowed(this)},signIn:function(){Talkio.Variables.socket.connect(),this.authenticate()},signOut:function(){Talkio.Variables.chat_room.is_iframe&&Talkio.Variables.socket.connectAJAX(),this.clear(),this.deauthenticate()},checkIfAllowed:function(){Talkio.Variables.channel_settings.isAllowed(this)?this.authenticate():this.deauthenticate()},setTyping:function(){this._typing||(this._typing=!0,Talkio.Variables.socket.publishPrivateMessage("user_is_typing"))},setCancelledTyping:function(){this._typing&&(this._typing=!1,Talkio.Variables.socket.publishPrivateMessage("user_cancelled_typing"))},makeOwner:function(){this.owner||(this.owner=!0,Talkio.Variables.owned_channels.add({permalink:Talkio.Variables.permalink}),this.trigger("ownership_changed"))},resignOwner:function(){this.owner&&(this.owner=!1,Talkio.Variables.owned_channels.remove(Talkio.Variables.permalink),this.trigger("ownership_changed"))},isOwner:function(){return this.owner},isAnonymous:function(){return"anonymous"==this.get("provider")},placeholder:function(){return this.get("nickname")+"..."}}),Talkio.Models.Message=Backbone.Model.extend({defaults:{expired:!1},urlRoot:function(){return Talkio.Paths.messages},justAdded:function(){return this.get("just_added")},author:function(){return{id:this.get("user_token"),nickname:this.get("nickname"),timestamp:this.get("timestamp"),user:this.get("user"),initials:this.get("nickname")[0],profile_url:this.get("user")&&this.get("user").profile_url}},"delete":function(){$.post(this.url(),{_method:"DELETE"},_.bind(function(){window.ga("send","event","messages","deleted",this.id)},this))},isDeleted:function(){return this.get("deleted")},markAsDeleted:function(e){this.set("body",e),this.set("deleted",!0)},hasExpired:function(e){return new Date-this.createdAt()>1e3*e},markAsExpired:function(){this.set("expired",!0)},plainBody:function(){return $("<div />").html(this.get("body")).text()},createdAt:function(){return new Date(1e3*this.get("timestamp"))},isReadByCurrentUser:function(){return!Talkio.Variables.chat_room.getInactivityTimestamp()||Talkio.Variables.chat_room.getInactivityTimestamp()>this.get("timestamp")},canBeDeletedBy:function(e){return Talkio.Variables.current_user.isOwner()||this.get("user_token")==e.id},processedBody:function(){var e=this.get("body"),t=[[/(^|\s)@([\.a-zA-Z0-9_-]+)/gi,'$1<a href="#" class="reply" data-reply-to="$2">@$2</a>'],[/(^|\s)#([a-zA-Z0-9_-]+)/gi,'$1<a href="/$2" target="_blank">#$2</a>'],[/(^|\s):\-?\)($|\s)/g,'$1<i data-smiley="happy"></i>$2'],[/(^|\s):\-?D($|\s)/g,'$1<i data-smiley="laugh"></i>$2'],[/(^|\s):\-?\(($|\s)/g,'$1<i data-smiley="unhappy"></i>$2'],[/(^|\s):\-?\@($|\s)/g,'$1<i data-smiley="angry"></i>$2'],[/(^|\s):&#39;\-?\(($|\s)/g,'$1<i data-smiley="cry"></i>$2'],[/(^|\s):\-?\o($|\s)/gi,'$1<i data-smiley="surprised"></i>$2'],[/(^|\s);\-?\)($|\s)/g,'$1<i data-smiley="wink"></i>$2'],[/(^|\s):\-?\p($|\s)/gi,'$1<i data-smiley="tongue"></i>$2'],[/(^|\s):\-?\/($|\s)/g,'$1<i data-smiley="displeased"></i>$2'],[/(^|\s):\-?\|($|\s)/g,'$1<i data-smiley="sleep"></i>$2'],[/(^|\s)(0|o):\-?\)($|\s)/gi,'$1<i data-smiley="saint"></i>$3'],[/(^|\s)\}:\-?\)($|\s)/gi,'$1<i data-smiley="devil"></i>$2'],[/(^|\s)\(y\)($|\s)/gi,'$1<i data-smiley="thumbsup"></i>$2']];return _.each(t,function(t){e=e.replace(t[0],t[1])}),e}}),Talkio.Models.Statistics=Backbone.Model.extend({defaults:{non_empty_room_count:0,twitter_user_count:0,non_twitter_user_count:0,total_user_count:0,last_minute_rate:98},loggedInCount:function(){return this.get("twitter_user_count")+this.get("non_twitter_user_count")},guestsCount:function(){return this.get("total_user_count")-this.loggedInCount()}}),Talkio.Models.User=Backbone.Model.extend({idAttribute:"token",owner:!1,setTyping:function(){this.set("is_typing",!0)},setCancelledTyping:function(){this.set("is_typing",!1)},isAnonymous:function(){return"anonymous"==this.get("provider")},ban:function(){this.set("banned",!0)},unban:function(){this.set("banned",!1)},isBanned:function(){return this.get("banned")},isMuted:function(){return _.include(Talkio.Variables.muted_user_ids,this.id)},isTyping:function(){return this.get("is_typing")},isCurrentUser:function(){return this.id==Talkio.Variables.current_user.id},placeholder:function(){return this.get("nickname")+"..."},profileURL:function(){return this.get("profile_url")},biggerAvatar:function(){return this.get("avatar").replace("_normal.","_bigger.")}}),Talkio.Models.UserSettings=Backbone.Model.extend({defaults:{sound_enabled:!1,notifications_enabled:!1,notifications_supported:!1,current_theme:"theme--day",previous_theme:null},_persisted_settings:["sound_enabled","notifications_enabled","current_theme"],_storage_key:"tlkio.user_settings",initialize:function(){this.readSettings(),Talkio.Variables.theme.length&&this.set("current_theme",Talkio.Variables.theme),this.listenTo(this,_.map(this._persisted_settings,function(e){return"change:"+e}).join(" "),this.writeSettings),window.notify.isSupported&&(this.set("notifications_supported",!0),this.get("notifications_enabled")&&this.set("notifications_enabled","granted"==window.notify.permissionLevel()))},readSettings:function(){var e=window.localStorage[this._storage_key];_.isString(e)&&_.each(_.pick(JSON.parse(e),this._persisted_settings),function(e,t){this.set(t,e)},this)},writeSettings:function(){var e={};_.each(this._persisted_settings,function(t){e[t]=this.get(t)},this),window.localStorage[this._storage_key]=JSON.stringify(e)},toggleSound:function(){this.isSoundEnabled()?this.set("sound_enabled",!1):(this.set("sound_enabled",!0),Talkio.Variables.chat_room.playSound())},toggleNotifications:function(){this.get("notifications_enabled")?this.set("notifications_enabled",!1):window.notify.requestPermission(_.bind(function(){"granted"==window.notify.permissionLevel()&&(this.set("notifications_enabled",!0),Talkio.Variables.chat_room.displayNotification("Notifications are enabled",""))},this))},setTheme:function(e){this.get("current_theme")!=e&&(this.set("previous_theme",this.get("current_theme")),this.set("current_theme",e))},isSoundEnabled:function(){return this.get("sound_enabled")},areNotificationsSupported:function(){return this.get("notifications_supported")},areNotificationsEnabled:function(){return this.get("notifications_supported")&&this.get("notifications_enabled")}}),Talkio.Collections.Channels=Backbone.Collection.extend({model:Talkio.Models.Channel}),Talkio.Collections.Messages=Backbone.Collection.extend({model:Talkio.Models.Message,url:function(){return Talkio.Paths.messages},loadEarlierMessages:function(){this.fetch({add:!0,remove:!1,silent:!0,at:0,data:{before_id:this.first()&&this.first().id},success:_.bind(function(e,t){this.trigger("earlier_messages_loaded",{count:t.length})},this)})},loadNewMessages:function(){this.fetch({add:!0,remove:!1,data:{after_id:this.last()&&this.last().id},success:function(){Talkio.Variables.connectionIndicator.setStatus("online")},error:function(){Talkio.Variables.connectionIndicator.setStatus("error")}})},nonExpired:function(){return this.where({expired:!1})},deleteOwnMessages:function(){Talkio.Variables.current_user.isSignedIn()&&$.post(this.url()+"/delete_all",function(){window.ga("send","event","messages","deleted","own")})},deleteAllMessages:function(){Talkio.Variables.current_user.isSignedIn()&&Talkio.Variables.current_user.isOwner()&&$.ajax(Talkio.Paths.chat,{type:"DELETE"},function(){window.ga("send","event","messages","deleted","all")})},markAsDeleted:function(e,t){var i=this.get(e);i&&i.markAsDeleted(t)},markAsDeletedForUser:function(e,t){var i=this.filter(function(t){return t.get("user_token")==e});_.each(i,function(e){e.markAsDeleted(t)}),this.trigger("messages_deleted",e)}}),Talkio.Collections.Owners=Backbone.Collection.extend({model:Talkio.Models.User,initialize:function(){}}),Talkio.Collections.Users=Backbone.Collection.extend({model:Talkio.Models.User,current_user:null,current_user_id:null,initialize:function(){},isCurrentUser:function(e){return e==Talkio.Variables.current_user.id},muted:function(){return this.filter(function(e){return e.isMuted()})},banned:function(){return this.filter(function(e){return e.isBanned()})},addUserWithData:function(e,t){e&&!this.get(e.token)&&this.add(e,t)},removeUser:function(e){var t=this.get(e);this.remove(t)}}),Talkio.Views.AdminSettings=Talkio.Classes.AsidePanel.extend({template:Talkio.Templates.admin_settings,el:"#admin-settings",events:{"click #become-owner":"becomeOwner","click #resign-ownership":"resignOwnership","click #allow-anonymous":"toggleAllowAnonymous"},owners_list:null,remove_my_messages_button:null,remove_all_messages_button:null,_resign_button_pressed:!1,_messages_removed:!1,initialize:function(){this.listenTo(this.model,"ownership_changed",this.render),this.listenTo(Talkio.Variables.channel_settings,"change:allow_anonymous",this.renderAllowAnonymous)},render:function(){return options={},options.permalink=Talkio.Variables.permalink,options.is_hero=!this.model.isAnonymous(),options.is_owner=this.model.isOwner(),options.is_logged_in=this.model.isSignedIn(),options.has_owner=Talkio.Variables.owners.length>0,this.$el.html(this.template(options)),this.owners_list=new Talkio.Views.OwnersList({collection:Talkio.Variables.owners}).render(),delete this.remove_my_messages_button,delete this.remove_all_messages_button,this.model.isSignedIn()&&(this.remove_my_messages_button=new Talkio.Views.RemoveMessagesButton({el:"#remove-my-messages",label:"Delete my messages",confirmation_label:"Yes, remove all my messages from this channel!",remove_function:function(){Talkio.Variables.messages.deleteOwnMessages()}}).render(),this.model.isOwner()&&(this.remove_all_messages_button=new Talkio.Views.RemoveMessagesButton({el:"#remove-all-messages",label:"Delete all messages",confirmation_label:"Yes, remove all messages from this channel!",remove_function:function(){Talkio.Variables.messages.deleteAllMessages()}}).render(),this.renderAllowAnonymous())),this},renderAllowAnonymous:function(){Talkio.Variables.channel_settings.allowAnonymous()?this.$("#allow-anonymous").addClass("isOn"):this.$("#allow-anonymous").removeClass("isOn")},enableRemoveButtons:function(){this.remove_my_messages_button&&this.remove_my_messages_button.enable(),this.remove_all_messages_button&&this.remove_all_messages_button.enable()},becomeOwner:function(){$.post(Talkio.Paths.ownership,_.bind(function(e){e.errors?alert(e.errors[0]):(this.model.makeOwner(),window.ga("send","event","moderator","added",this.model.id))},this),"JSON")},resignOwnership:function(){this._resign_button_pressed?this.checkChannelConfirmation()&&$.post(Talkio.Paths.ownership,{_method:"DELETE"},_.bind(function(){this.hideConfirmation(),this.model.resignOwner(),window.ga("send","event","moderator","removed",this.model.id)},this),"JSON"):this.showConfirmation()},toggleAllowAnonymous:function(){Talkio.Variables.channel_settings.toggleAllowAnonymous()},checkChannelConfirmation:function(){var e=this.$("#channel-confirmation").val();return e.length>0&&e==Talkio.Variables.permalink},showConfirmation:function(){this.$("div.owner-confirm").removeClass("isHidden"),this._resign_button_pressed=!0},hideConfirmation:function(){this._resign_button_pressed=!1,this.$("div.owner-confirm").addClass("isHidden")},checkBecomeOwnerButton:function(){Talkio.Variables.messages.nonExpired().length>0?this.$("#become-owner").hide():this.$("#become-owner").show()},onShow:function(){this.hideConfirmation(),this.checkBecomeOwnerButton()}}),Talkio.Views.OwnersList=Backbone.View.extend({el:"#owners-list",initialize:function(){this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this)},render:function(){return this.$el.html(""),this.collection.each(function(e){this.$el.append(Talkio.Templates.owner(e.attributes))},this),this}}),Talkio.Views.RemoveMessagesButton=Backbone.View.extend({events:{click:"removeMessages"},was_already_clicked:!1,label:null,confirmation_label:null,remove_function:null,initialize:function(e){e&&(this.label=e.label,this.confirmation_label=e.confirmation_label,this.remove_function=e.remove_function)},render:function(){return this.was_already_clicked?this.$el.html(this.confirmation_label):this.$el.html(this.label),this},removeMessages:function(e){e.preventDefault(),this.was_already_clicked?(this.remove_function&&this.remove_function.call(),this.was_already_clicked=!1,this.$el.addClass("disabled")):(this.was_already_clicked=!0,setTimeout(_.bind(this.reset,this),4e3)),this.render()},reset:function(){this.was_already_clicked&&(this.was_already_clicked=!1,this.render())},enable:function(){this.$el.removeClass("disabled"),this.messages_removed=!1}}),Talkio.Views.Aside=Backbone.View.extend({el:"aside",events:{"click #admin-button":"toggleAdminSettings","click #user-button":"toggleUserSettings","click #share_button":"showShare"},previous_theme:null,current_theme:"theme--day",share_view:null,user_settings:null,admin_settings:null,initialize:function(){this.listenTo(Talkio.Variables.current_user,"currentUserChanged",this.configureUserButton),this.listenTo(Talkio.Variables.messages,"add",this.enableRemoveButtons),this.admin_settings=new Talkio.Views.AdminSettings({model:Talkio.Variables.current_user}).render(),this.user_settings=new Talkio.Views.UserSettings({model:Talkio.Variables.user_settings}).render(),this.share_view=(new Talkio.Views.ShareView).render(),Talkio.Variables.online_users=new Talkio.Views.OnlineUsers({collection:this.collection}),Talkio.Variables.user_counter=new Talkio.Views.UserCounter({collection:this.collection,elements:["#user-counter","#panel-counter"]}).render()},render:function(){return this.configureUserButton(),this},configureUserButton:function(){var e=this.$("#user-button").removeClass("isTroll isHero").removeAttr("style");Talkio.Variables.current_user.isSignedIn()&&(Talkio.Variables.current_user.isAnonymous()?e.addClass("isTroll"):e.addClass("isHero").attr("style","background-image: url("+Talkio.Variables.current_user.get("avatar")+");"))},showShare:function(){this.share_view.show()},enableRemoveButtons:function(){this.admin_settings.enableRemoveButtons()},toggleAdminSettings:function(e){e.preventDefault(),e.stopPropagation(),this.user_settings.hide(),this.admin_settings.toggle()},toggleUserSettings:function(e){e.preventDefault(),e.stopPropagation(),this.admin_settings.hide(),this.user_settings.toggle()},setConnected:function(){this.$el.removeClass("not-connected")}}),Talkio.Views.ShareView=Backbone.View.extend({tagName:"section",className:"popup hide",events:{"click #popup-close":"hide",click:"checkHide"},zclip_initialized:!1,render:function(){return this.$el.html(Talkio.Templates.share()).appendTo("body"),this},show:function(){this.$el.removeClass("hide"),this.zclip_initialized?this.$(".url_button").zclip("show"):(this.$(".url_button").zclip({path:"/ZeroClipboard.swf",copy:window.location.href}),this.zclip_initialized=!0)},hide:function(){this.$el.addClass("hide"),this.$(".url_button").zclip("hide")},checkHide:function(e){e.target==this.el&&this.hide()},doNothing:function(e){e.preventDefault(),e.stopPropagation()},clickedLink:function(e){e.stopPropagation()}}),Talkio.Views.MutedUsers=Backbone.View.extend({el:"#ban-list",initialize:function(){Talkio.Variables.muted_user_ids=[],Cookies.get("ban_list")&&(Talkio.Variables.muted_user_ids=_.map(Cookies.get("ban_list").split(","),function(e){return e})),this.collection.on("addMutedUser",this.render,this),this.collection.on("removeMutedUser",this.render,this)},render:function(){var e=_.map(this.collection.muted(),function(e){return".author_"+e.id+" { display: none; }"});return this.$el.text(e.join("\n")),this}}),Talkio.Views.ChatRoom=Backbone.View.extend({el:"body",events:{"click #scroll_down":"scrollToBottom","click #panel-button":"togglePanel"},window_is_inactive:!1,inactive_since:null,inactive_messages:0,remove_unread_timeout:null,scroll_timeout:null,view_at_the_bottom:!0,is_iframe:!1,is_offline:!1,sound:document.getElementById("audio_new"),initialize:function(){window!=window.top&&(this.is_iframe=!0),Modernizr.touch||$("html").addClass("no-touch"),Talkio.Variables.current_user.on("currentUserChanged",this.changeBodyClass,this),Talkio.Variables.user_settings=new Talkio.Models.UserSettings,Talkio.Variables.messages=new Talkio.Collections.Messages,Talkio.Variables.muted_users=new Talkio.Views.MutedUsers({collection:this.collection}).render(),Talkio.Variables.header=new Talkio.Views.Header({collection:Talkio.Variables.owners}).render(),Talkio.Variables.aside=new Talkio.Views.Aside({collection:this.collection}).render(),Talkio.Variables.footer=new Talkio.Views.Footer({model:Talkio.Variables.current_user}).render(),Talkio.Variables.live=new Talkio.Views.Messages({el:"#live",collection:Talkio.Variables.messages}),Talkio.Variables.connectionIndicator=(new Talkio.Views.ConnectionIndicator).render(),Talkio.Variables.$window=$(window),Talkio.Variables.$document=$(document),Talkio.Variables.$header=$("header"),Talkio.Variables.$footer=$("footer"),Talkio.Variables.$aside=$("aside"),this.$load_messages_button=$("#load-button"),this.$scroll_down_arrow=$("#scroll_down"),this.$message_input=$("#message_body"),Talkio.Variables.messages.on("add",this.notifyUser,this),Talkio.Variables.owners.on("add",this.changeBodyClass,this),Talkio.Variables.owners.on("remove",this.changeBodyClass,this),Talkio.Variables.$window.on("blur",_.bind(this.onWindowBlur,this)).on("focus",_.bind(this.onWindowFocus,this)).on("scroll",_.bind(this.onWindowScroll,this)).on("beforeunload",_.bind(this.onWindowBeforeUnload,this)),Talkio.Variables.live.on("rendered",this.onWindowFocus,this),this.changeBodyClass(),this.readInactivityTimestamp(),this.removeExpiredMessages(),Talkio.Variables.messages.fetch({reset:!0}),Talkio.Variables.socket=new Socket,Talkio.Variables.current_user.isSignedIn()||!this.is_iframe?setTimeout(_.bind(Talkio.Variables.socket.connect,Talkio.Variables.socket),2e3):Talkio.Variables.socket.connectAJAX()},hasOnwer:function(){return Talkio.Variables.owners.length>0},removeExpiredMessages:function(){var e=Talkio.Variables.channel_settings.historyTTL();if(_.isNumber(e)){var t=Talkio.Variables.messages.nonExpired();_.each(t,function(t){t.hasExpired(e)&&t.markAsExpired()}),setTimeout(_.bind(this.removeExpiredMessages,this),5e3)}},changeBodyClass:function(){this.$el.removeClass("isHero isTroll isVirgin"),Talkio.Variables.current_user.isSignedIn()?this.$el.addClass(Talkio.Variables.current_user.isAnonymous()?"isHero":"isTroll"):this.$el.addClass("isVirgin"),this.hasOnwer()>0?this.$el.addClass("hasOwner"):this.$el.removeClass("hasOwner")},togglePanel:function(){$("body").toggleClass("showPanel")},softScrollToBottom:function(){this.view_at_the_bottom?this.scrollToBottom():this.$scroll_down_arrow.addClass("new")},scrollToBottom:function(e){typeof e!=undefined&&this.$scroll_down_arrow.removeClass("show"),Talkio.Variables.$window.scrollTop(Talkio.Variables.$document.height())},updateWindowTitle:function(){Tinycon.setBubble(this.inactive_messages)},playSound:function(){if(Talkio.Variables.user_settings.isSoundEnabled())try{this.sound.play()}catch(e){}},showNotification:function(e){
Talkio.Variables.user_settings.areNotificationsEnabled()&&this.displayNotification(e.plainBody(),"from "+e.get("nickname"))},displayNotification:function(e,t){var i=notify.createNotification(e,{icon:"/images/logo.png",body:t});setTimeout(function(){i.close()},3e3)},notifyUser:function(e){var t=Talkio.Variables.users.get(e.get("user_token"));this.window_is_inactive&&!t.isMuted()&&(this.inactive_messages+=1,this.updateWindowTitle(),this.playSound(),this.showNotification(e))},onWindowBlur:function(){this.window_is_inactive=!0,this.saveInactivityTimestamp(),clearTimeout(this.remove_unread_timeout)},onWindowFocus:function(){this.window_is_inactive=!1,this.inactive_messages=0,this.updateWindowTitle(),!this.view_at_the_bottom||this.is_iframe||Modernizr.touch||this.$message_input.focus(),this.resetInactivityTimestamp(),this.remove_unread_timeout=setTimeout(function(){$("#chat dd.unread").removeClass("unread")},4e3)},onWindowBeforeUnload:function(){this.saveInactivityTimestamp()},onWindowScroll:function(){clearTimeout(this.scroll_timeout),this.scroll_timeout=setTimeout(_.bind(function(){Talkio.Variables.$window.scrollTop()+120>=Talkio.Variables.$document.height()-Talkio.Variables.$window.height()?(this.$scroll_down_arrow.removeClass("show").removeClass("new"),this.view_at_the_bottom=!0):(this.$scroll_down_arrow.addClass("show"),this.view_at_the_bottom=!1),Talkio.Variables.$window.scrollTop()+10>=Talkio.Variables.$document.height()-Talkio.Variables.$window.height()?$("html").removeClass("isAtBottom"):$("html").addClass("isAtBottom")},this),200)},authWith:function(e){var t="/auth/"+e+"?origin="+encodeURIComponent("/"+Talkio.Variables.permalink);this.is_iframe?this.openPopupWindow(t,"Login with "+e,600,500):window.location.href=t},openPopupWindow:function(e,t,i,n){window.open(e,t,"width="+i+", height="+n+", modal=no, resizable=no, toolbar=no, menubar=no, scrollbars=no, alwaysRaise=yes")},getInactivityTimestamp:function(){return this.inactive_since},readInactivityTimestamp:function(){Cookies.get("inactive_since")&&(this.inactive_since=parseInt(Cookies.get("inactive_since"),10))},saveInactivityTimestamp:function(){this.inactive_since=Math.round((new Date).getTime()/1e3),Cookies.set("inactive_since",this.inactive_since,{path:window.location.pathname})},resetInactivityTimestamp:function(){this.inactive_since=null,Cookies.remove("inactive_since",{path:window.location.pathname})}}),Talkio.Views.ConnectionIndicator=Backbone.View.extend({el:"span.header-status",_timer:null,_status:null,_statuses:{progress:"Connecting",online:"Online",error:"Disconnected",hidden:"Online"},render:function(){return this.setStatus("progress"),this},setStatus:function(e){this._status!=e&&(this._timer&&clearTimeout(this._timer),this.$el.removeClass("is-hidden").removeClass(this.statusClass()),this._status=e,this.$el.addClass(this.statusClass()).attr("title",this.statusTitle()),"online"==this._status&&(this._timer=setTimeout(_.bind(this.hide,this),5e3)))},hide:function(){this.$el.removeClass(this.statusClass()).addClass("is-hidden")},statusClass:function(){return"is-"+this._status},statusTitle:function(){return this._statuses[this._status]}}),Talkio.Views.Footer=Backbone.View.extend({el:"footer",events:{"submit #participant-form":"joinAsTroll","submit #new_message":"submitMessage","click #twitter-button":"joinWithTwitter","click #fb-button":"joinWithFacebook","click #join-toggleButton":"toggleJoin","keydown #message_body":"messageKeydown","keyup #message_body":"messageKeyup","focus #message_body":"messageFocus","blur  #message_body":"messageBlur"},message_body_overflow:0,scroll_height_padding:0,$message_body:null,$footer_avatar:null,$submit_button:null,initialize:function(){this.model.on("currentUserChanged",this.render,this)},render:function(){return this.model.isSignedIn()?(this.model.on("change:nickname",this.changePlaceholder,this),this.$el.html(Talkio.Templates.message_form(this.model.attributes)),this.$message_body=this.$("#message_body"),this.$footer_avatar=this.$("#footer-avatar"),this.$submit_button=this.$("#submit-button"),this.changePlaceholder(),this.$message_body[0].scrollHeight<50&&(this.scroll_height_padding=22)):this.$el.html(Talkio.Templates.join_chatroom({options:Talkio.Variables.channel_settings.attributes})),this},changePlaceholder:function(){this.$message_body.attr("placeholder",this.model.placeholder())},toggleJoin:function(e){e.preventDefault(),this.$("#join-toggleButton").css({display:"none"}),this.$("#join").css({display:"block"}),Talkio.Variables.chat_room.scrollToBottom()},joinAsTroll:function(e){e.preventDefault();var t=this.$("#participant_nickname").val().trim();t.length&&this.model.save({nickname:t},{wait:!0})},joinWithTwitter:function(e){e.preventDefault(),Talkio.Variables.chat_room.authWith("twitter")},joinWithFacebook:function(e){e.preventDefault(),Talkio.Variables.chat_room.authWith("facebook")},messageKeydown:function(e){this.$message_body.val().length;if(13==e.keyCode&&!e.shiftKey)return e.preventDefault(),this.submitMessage(),!1},messageKeyup:function(e){var t;if(13!=e.keyCode||e.shiftKey){var i=this.$message_body.val(),n=i.length;n>10?this.model.setTyping():0==n&&this.model.setCancelledTyping();var s=this.$message_body[0].scrollHeight-50;s!=this.message_body_overflow&&(this.$message_body[0].style.height="auto",s=this.$message_body[0].scrollHeight-50,this.message_body_overflow=s,this.$message_body.css({height:50+this.message_body_overflow+this.scroll_height_padding+"px"}),Talkio.Variables.chat_room.scrollToBottom()),t="rotate("+n+"deg)"}else t="rotate(0deg)";this.$footer_avatar.css({transform:t})},messageFocus:function(){this.$el.addClass("hasFocus"),this.$submit_button&&this.$submit_button.removeClass("show"),Modernizr.touch&&(Talkio.Variables.$aside.addClass("removed"),Talkio.Variables.$header.addClass("removed"))},messageBlur:function(){this.$el.removeClass("hasFocus"),this.$message_body.val().length>0&&this.$submit_button.addClass("show"),Modernizr.touch&&(Talkio.Variables.$aside.removeClass("removed"),Talkio.Variables.$header.removeClass("removed"),Talkio.Variables.chat_room.scrollToBottom())},replyToUsername:function(e){if(e){var t=this.$message_body.val(),i="@"+e+" ";t.length>0&&" "!=t[t.length-1]&&this.$message_body.val(t+" "),this.$message_body.val(this.$message_body.val()+i).focus(),this.$message_body[0].selectionStart=this.$message_body[0].selectionEnd=this.$message_body.val().length,Talkio.Variables.chat_room.scrollToBottom()}},submitMessage:function(e){(e&&e.preventDefault(),this.$message_body.val().length>0)&&(new Talkio.Models.Message({body:this.$message_body.val()}).save({},{success:function(){window.ga("send","event","message","sent")}}),this.model._typing=!1,this.$submit_button.removeClass("show"),this.$message_body.val("").attr({style:""}),this.message_body_overflow=0,this.$footer_avatar.css({transform:"rotate(0deg)"}))}}),Talkio.Views.Header=Backbone.View.extend({el:"#header",$logo:null,initialize:function(){this.$logo=this.$("a.header-avatar"),this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this)},render:function(){if(this.collection.length>0){var e=this.collection.first();this.$logo.css("backgroundImage","url("+e.biggerAvatar()+")").attr("href",e.get("profile_url")).attr("target","_blank")}else this.$logo.css("backgroundImage","").attr("href","http://tlk.io").removeAttr("target");return this}}),Talkio.Views.Messages=Backbone.View.extend({events:{"click #load-button":"loadEarlierMessages"},silent:!1,initialize:function(e){e.silent&&(this.silent=e.silent),this.collection.on("reset",this.render,this),this.collection.on("add",this.renderMessage,this),this.collection.on("earlier_messages_loaded",this.renderEarlierMessages,this),this.collection.on("messages_deleted",this.markDeletedMessages,this),this.current_message_container=null,this.current_timestamp=0,this.timestamp_format="",this.traling_timestamp=!1,this.$load_button=this.$("#load-button")},setNewMessageContainer:function(e){this.current_message_container=new Talkio.Views.MessagesContainer({author:e}),this.$el.append(this.current_message_container.render().el),this.traling_timestamp=!1},render:function(){return this.collection.size()>0?(this.current_timestamp=this.collection.first().get("closest_milestone"),this.collection.each(this.renderMessage,this),this.renderCurrentTimestamp(),this.collection.size()>=Talkio.Variables.message_view_limit&&this.$load_button.addClass("show"),this.silent||Talkio.Variables.chat_room.scrollToBottom()):(this.$el.empty(),this.$load_button.removeClass("show"),this.current_message_container=null),Talkio.Variables.chat_room.resetInactivityTimestamp(),this.trigger("rendered"),this},renderMessage:function(e){this.current_message_container?this.current_timestamp!=e.get("closest_milestone")?(this.renderCurrentTimestamp(),this.current_timestamp=e.get("closest_milestone"),this.setNewMessageContainer(e.author())):this.current_message_container&&!this.current_message_container.isCurrentAuthor(e.author())&&this.setNewMessageContainer(e.author()):this.setNewMessageContainer(e.author()),this.current_message_container.renderMessage(e)},renderCurrentTimestamp:function(){this.current_message_container.$el.addClass("last-of-time"),!this.traling_timestamp&&this.current_timestamp>0&&(this.$el.append($('<time class="time" />').html(Talkio.Variables.timestamps[this.current_timestamp])),this.traling_timestamp=!0)},renderEarlierMessages:function(e){if(e.count>0){var t=new Talkio.Collections.Messages(this.collection.first(e.count)),i=new Talkio.Views.Messages({collection:t,silent:!0}),n=this.$("dl:first"),s=n.position().top-Talkio.Variables.$window.scrollTop();this.$load_button.after(i.render().$el),Talkio.Variables.$window.scrollTop(n.position().top-s)}this.$load_button.removeClass("isLoading"),e.count<Talkio.Variables.message_view_limit&&this.$load_button.removeClass("show"),delete t,delete i},loadEarlierMessages:function(){this.$load_button.addClass("isLoading"),this.collection.loadEarlierMessages()},markDeletedMessages:function(e){$("#chat dl.author_"+e).addClass("deleted")}}),Talkio.Views.MessagesContainer=Backbone.View.extend({tagName:"dl",events:{"click  .js-reply":"reply"},author:null,initialize:function(e){this.author=e.author},isCurrentAuthor:function(e){return this.author&&this.author.id==e.id},hasMessages:function(){return this.messages.length>0},render:function(){return this.author&&(this.$el.addClass("post author_"+this.author.id).attr("data-user-id",this.author.id).attr("data-user-nickname",this.author.nickname),Talkio.Variables.users.isCurrentUser(this.author.id)&&this.$el.addClass("me"),this.renderAuthor()),this},renderMessage:function(e){this.$el.append(new Talkio.Views.Message({model:e}).render().el)},renderAuthor:function(){this.$el.append(Talkio.Templates.message_author(this.author))},reply:function(e){e.preventDefault(),Talkio.Variables.footer.replyToUsername(this.author.nickname)}}),Talkio.Views.Message=Backbone.View.extend({template:Talkio.Templates.message,tagName:"dd",events:{"click      a.reply":"reply","click      img":"toggleImage","mouseenter .post-time":"showTimestamp","click      .post-time-dot":"showTimestamp","click      .js-post-time-tag":"toggleTimestamp","click      #delete-message":"deleteMessage"},timestamp_format:null,$delete_button:null,initialize:function(){Talkio.Variables.current_user.on("ownership_changed",this.configureOwner,this),this.model.on("change:deleted",this.markAsDeleted,this),this.model.on("change:expired",this.markAsExpired,this)},reply:function(e){e.preventDefault(),Talkio.Variables.footer.replyToUsername($(e.target).data("reply-to"))},toggleImage:function(e){$(e.target).toggleClass("expanded")},markAsDeleted:function(){this.model.isDeleted()&&this.$el.addClass("deleted").html(this.model.get("body"))},markAsExpired:function(){this.$el.addClass("expired")},configureOwner:function(){this.model.canBeDeletedBy(Talkio.Variables.current_user)?this.$delete_button.show():this.$delete_button.hide()},showTimestamp:function(){this.$(".js-post-time-tag").text($.timeago(this.model.createdAt())),this.timestamp_format="relative"},toggleTimestamp:function(){"relative"==this.timestamp_format?(this.$(".js-post-time-tag").text(this.model.createdAt().toLocaleString()),this.timestamp_format="absolute"):this.showTimestamp()},deleteMessage:function(){this.model.canBeDeletedBy(Talkio.Variables.current_user)&&this.model["delete"]()},render:function(){var e=this.model.processedBody();if(Talkio.Variables.current_user.isSignedIn()){var t=new RegExp(">@"+Talkio.Variables.current_user.get("nickname")+"<","i");e.match(t)&&this.$el.addClass("is-reply")}return this.$el.addClass("post-message").attr("data-timestamp",this.model.get("timestamp")).html(this.template({body:e})),this.$('a[data-type="image"]').each(_.bind(function(e,t){this.$el.prepend('<img class="post-img" src="'+$(t).attr("href")+'" />')},this)),this.model.justAdded()&&!Talkio.Variables.chat_room.window_is_inactive&&this.$el.addClass("animate"),this.model.isReadByCurrentUser()||this.$el.addClass("unread"),this.$delete_button=this.$("#delete-message"),this.configureOwner(),this.markAsDeleted(),this}}),Talkio.Views.OnlineUsers=Backbone.View.extend({el:"#online-participants",initialize:function(){this.collection.on("add",this.renderUser,this),this.collection.on("remove",this.checkUserAmount,this),this.collection.on("set_offline",this.setAllUsersOffline,this),this.collection.on("change:banned",this.toggleUser,this)},render:function(){return this.$el.html(""),this.collection.each(this.renderUser,this),this},renderUser:function(e){this.$el.append(new Talkio.Views.OnlineUser({model:e}).render().el),this.checkUserAmount()},checkUserAmount:function(){var e=this.$el.parents("aside");this.collection.length>0?e.removeClass("hasZeroParticipants"):e.addClass("hasZeroParticipants")},setAllUsersOffline:function(){this.$("li").addClass("offline")},toggleUser:function(e){e.isBanned()?this.$("#author_"+e.id).remove():this.renderUser(e)}}),Talkio.Views.OnlineUser=Backbone.View.extend({tagName:"li",events:{click:"toggleUserMute"},initialize:function(){this.model.on("remove",this.remove,this),this.model.on("new_message",this.moveToTop,this),this.model.on("change:nickname",this.rename,this),this.model.on("change:is_typing",this.setTyping,this)},toggleUserMute:function(){Talkio.Variables.users.isCurrentUser(this.model.id)||(this.$el.toggleClass("muted"),this.model.isMuted()?(Talkio.Variables.muted_user_ids=_.without(Talkio.Variables.muted_user_ids,this.model.id),this.model.trigger("removeMutedUser",this)):(Talkio.Variables.muted_user_ids.push(this.model.id),this.model.trigger("addMutedUser",this)),Cookies.set("ban_list",Talkio.Variables.muted_user_ids.join(","),{expires:7,path:window.location.pathname}),Talkio.Variables.chat_room.scrollToBottom())},moveToTop:function(){this.$el.removeClass("updated").detach().removeClass("typing").prependTo("#online-participants").addClass("updated")},setTyping:function(){this.model.isTyping()?this.$el.addClass("typing"):this.$el.removeClass("typing")},rename:function(e){this.$el.html(e.get("nickname"))},render:function(){return this.$el.attr("id","author_"+this.model.id).addClass("list-item").html(Talkio.Templates.online_user(this.model.attributes)),this.model.isMuted()&&this.$el.addClass("muted"),this}}),Talkio.Views.UserCounter=Backbone.View.extend({counter_elements:[],_guests_count:0,_users_count:0,initialize:function(e){this.counter_elements=e.elements,this.collection.on("add",this.updateCount,this),this.collection.on("remove",this.updateCount,this),this.collection.on("change:banned",this.updateCount,this)},updateCount:function(e){_.isNumber(e)&&(this._guests_count=e),this._users_count=this.collection.length-this.collection.banned().length,this.render()},increaseGuestsCount:function(){this._guests_count+=1,this.render()},decreaseGuestsCount:function(){this._guests_count-=1,this.render()},currentCount:function(){return this._users_count},render:function(){return _.each(this.counter_elements,function(e){$(e).text(this.currentCount())},this),this}}),Talkio.Views.UserSettings=Talkio.Classes.AsidePanel.extend({el:"#user-settings",events:{"click #mute_button":"toggleMute","click #notifications":"toggleNotifications","click #theme-picker li":"changeTheme","click #sign-out":"signOut"},$mute_button:null,$notifications_button:null,$sign_out_button:null,_owned_channels_list:null,initialize:function(){this._owned_channels_list=new Talkio.Views.OwnedChannelsList({collection:Talkio.Variables.owned_channels}),this.$mute_button=this.$("#mute_button"),this.$notifications_button=this.$("#notifications"),this.$sign_out_button=this.$("#sign-out"),this.model.on("change:sound_enabled",this.renderMuteButton,this),this.model.on("change:notifications_enabled",this.renderNotificationsButton,this),this.model.on("change:current_theme",this.renderTheme,this),Talkio.Variables.current_user.on("currentUserChanged",this.renderSignOutButton,this)},render:function(){return this.renderMuteButton(),this.renderNotificationsButton(),this.renderTheme(),this.renderSignOutButton(),this._owned_channels_list.render(),this},renderMuteButton:function(){this.model.isSoundEnabled()?this.$mute_button.addClass("isOn"):this.$mute_button.removeClass("isOn")},renderNotificationsButton:function(){this.model.areNotificationsSupported()?this.model.areNotificationsEnabled()?this.$notifications_button.addClass("isOn"):this.$notifications_button.removeClass("isOn"):this.$notifications_button.hide()},renderTheme:function(){this.$("#theme-picker .isSelected").removeClass("isSelected"),this.$("#theme-picker li[data-theme="+this.model.get("current_theme")+"]").addClass("isSelected"),$("html").removeClass(this.model.get("previous_theme")).addClass(this.model.get("current_theme"))},renderSignOutButton:function(){Talkio.Variables.current_user.isSignedIn()?this.$sign_out_button.show():this.$sign_out_button.hide()},toggleMute:function(e){e.preventDefault(),this.model.toggleSound()},toggleNotifications:function(e){e.preventDefault(),this.model.toggleNotifications()},changeTheme:function(e){e.preventDefault(),this.model.setTheme(this.$(e.currentTarget).data("theme"))},signOut:function(e){e.preventDefault(),$.post(Talkio.Paths.sign_out,_.bind(function(){Talkio.Variables.current_user.signOut(),this.hide()},this),"json"),this.$("#user-settings").removeClass("show")}}),Talkio.Views.OwnedChannelsList=Backbone.View.extend({el:"#owned-channel-list",$list:null,initialize:function(){this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this),this.$list=this.$("ul")},render:function(){return this.$("ul").html(""),Talkio.Variables.owned_channels.length>0?(Talkio.Variables.owned_channels.each(function(e){this.$list.append(Talkio.Templates.owned_channel(e.attributes))},this),this.$el.show()):this.$el.hide(),this}}),Talkio.Views.Widgets.DailyMessages=Backbone.View.extend({el:"#daily-messages",chart:null,hoverDetail:null,render:function(){if(!this.chart){var e=[];_.each(this.model.get("daily_messages"),function(t,i){e.push({x:i,y:t})}),this.chart=new Rickshaw.Graph({element:this.$(".chart").get(0),renderer:"area",stroke:!0,padding:{top:.05},series:[{color:"#eee",data:e}]}),this.chart.render()}return this}}),Talkio.Views.Widgets.MessageRate=Backbone.View.extend({el:"#message-rate",chart:null,hoverDetail:null,initialize:function(){this.model.on("change:messages_per_last_minute",this.render,this)},render:function(){if(!this.chart){var e=[];_.each(this.model.get("minutely_messages"),function(t,i){e.push({x:i,y:t})}),this.chart=new Rickshaw.Graph({element:this.$(".chart").get(0),renderer:"area",stroke:!0,padding:{top:.05},series:[{color:"#eee",data:e,name:"Messages"}]}),this.chart.render()}return this.$("em").text(this.model.get("messages_per_last_minute")),this}}),Talkio.Views.Widgets.OnlineUsers=Backbone.View.extend({el:"#online-users",chart:null,initialize:function(){this.model.on("change:twitter_user_count",this.render,this),this.model.on("change:non_twitter_user_count",this.render,this),this.model.on("change:total_user_count",this.render,this)},render:function(){var e=this.$("canvas").get(0).getContext("2d");return this.chart=new Chart(e).Pie([{value:this.model.get("twitter_user_count"),color:"#ddd"},{value:this.model.get("non_twitter_user_count"),color:"#fff"},{value:this.model.guestsCount(),color:"#bbb"}],{animationEasing:"easeOutQuad",animation:!1}),this.$(".total-users").text(this.model.get("total_user_count")),this.$(".twitter").text(this.model.get("twitter_user_count")),this.$(".non-twitter").text(this.model.get("non_twitter_user_count")),this.$(".guests").text(this.model.guestsCount()),this}}),Talkio.Views.Widgets.TotalChatrooms=Backbone.View.extend({el:"#total-chatrooms",chart:null,data:[],last_index:0,records_to_keep:20,initialize:function(){},grabNewData:function(){this.data.push({x:this.last_index,y:this.model.get("non_empty_room_count")}),this.last_index+=1,this.data.length>this.records_to_keep&&this.data.splice(0,this.data.length-this.records_to_keep)},render:function(){return this.grabNewData(),this.chart?this.chart.update():(this.chart=new Rickshaw.Graph({element:this.$(".chart").get(0),renderer:"area",interpolation:"linear",stroke:!0,padding:{top:.05},series:[{color:"#eee",data:this.data}]}),this.chart.render()),this.$("em").text(this.model.get("non_empty_room_count")),this}}),Talkio.Views.Widgets.TotalUsers=Backbone.View.extend({el:"#total-users",chart:null,render:function(){if(!this.chart){var e=[];_.each(this.model.get("total_users"),function(t,i){e.push({x:i,y:t})}),this.chart=new Rickshaw.Graph({element:this.$(".chart").get(0),renderer:"area",stroke:!0,padding:{top:.05},series:[{color:"#eee",data:e}]}),this.chart.render()}return this}});var Authenticator={outgoing:function(e,t){"/meta/subscribe"==e.channel&&(e.ext||(e.ext={}),Talkio.Variables.current_user.isSignedIn()&&(e.ext.token=Talkio.Variables.current_user.id)),t(e)}},Socket=function(){this.initialize.apply(this,arguments)};_.extend(Socket.prototype,{_faye_client:null,_socket_notifications:null,_private_subscription:null,_public_subscription:null,_AJAX_timer:null,initialize:function(){this._socket_notifications=new SocketNotifications,this._faye_client=new Faye.Client(Talkio.Variables.faye_server,{timeout:60}),this._faye_client.addExtension(Authenticator),this._faye_client.on("transport:up",function(){Talkio.Variables.aside.setConnected(),Talkio.Variables.connectionIndicator.setStatus("online"),Talkio.Variables.chat_room.is_offline&&(Talkio.Variables.chat_room.is_offline=!1)}),this._faye_client.on("transport:down",function(){Talkio.Variables.connectionIndicator.setStatus("error"),Talkio.Variables.chat_room.is_offline=!0,Talkio.Variables.users.trigger("set_offline")})},connect:function(){clearInterval(this._AJAX_timer),this._public_subscription=this._faye_client.subscribe(this.publicChannel(),_.bind(this.processMessage,this)),this._private_subscription=this._faye_client.subscribe(this.privateChannel(),_.bind(this.processMessage,this))},connectAJAX:function(){this.unsubscribe(),Talkio.Variables.connectionIndicator.setStatus("online"),this._AJAX_timer=setInterval(function(){Talkio.Variables.messages.loadNewMessages()},9e4)},disconnect:function(){this._faye_client.disconnect()},unsubscribe:function(){this._public_subscription&&this._public_subscription.cancel(),this._private_subscription&&this._private_subscription.cancel()},publicChannel:function(){return"/chats/"+Talkio.Variables.chat_id+"/public"},privateChannel:function(e){var t="/chats/"+Talkio.Variables.chat_id+"/private/"+Talkio.Variables.session_token;return _.isString(e)&&(t+="/"+e),t},publishPublicMessage:function(e,t){return this._faye_client.publish(this.publicChannel(),{type:e,data:t})},publishPrivateMessage:function(e,t){return this._faye_client.publish(this.privateChannel(e),t)},processMessage:function(e){this._socket_notifications.process(e)}});var SocketNotifications=function(){this.process=function(e){_.isString(e)&&(e=JSON.parse(e)),typeof e!=undefined&&e&&this.execute(e.type,e.data)},this.execute=function(e,t){this[e](t)},this.MESSAGE=function(e){Talkio.Variables.messages.add(_.defaults(e,{just_added:!0}));var t=(Talkio.Variables.messages.get(e.id),Talkio.Variables.users.get(e.user_token));t.set("is_typing",!1,{silent:!0}),t.trigger("new_message"),Talkio.Variables.chat_room.softScrollToBottom(),t.isCurrentUser()&&Talkio.Variables.aside.enableRemoveButtons()},this.MESSAGE_DELETED=function(e){Talkio.Variables.messages.markAsDeleted(e.id,e.body)},this.ALL_MESSAGES_DELETED=function(e){Talkio.Variables.messages.markAsDeletedForUser(e.user_token,e.body)},this.CHAT_UPDATED=function(e){Talkio.Variables.channel_settings.set(e.chat)},this.CHAT_DELETED=function(){Talkio.Variables.messages.reset()},this.ONLINE_PARTICIPANTS=function(e){Talkio.Variables.users.reset(),_.each(e.users,function(e){Talkio.Variables.users.addUserWithData(e,{silent:!0})}),Talkio.Variables.online_users.render(),Talkio.Variables.user_counter.updateCount(e.guests)},this.GUEST_JOINED=function(){Talkio.Variables.user_counter.increaseGuestsCount()},this.GUEST_LEFT=function(){Talkio.Variables.user_counter.decreaseGuestsCount()},this.USER_JOINED=function(e){Talkio.Variables.users.addUserWithData(e)},this.USER_LEFT=function(e){Talkio.Variables.users.removeUser(e.token)},this.USER_AUTHENTICATED=function(e){Talkio.Variables.users.addUserWithData(e),Talkio.Variables.user_counter.decreaseGuestsCount()},this.USER_DEAUTHENTICATED=function(e){Talkio.Variables.users.removeUser(e.token),Talkio.Variables.user_counter.increaseGuestsCount()},this.USER_IS_TYPING=function(e){var t=Talkio.Variables.users.get(e.token);t&&t.setTyping()},this.USER_CANCELLED_TYPING=function(e){var t=Talkio.Variables.users.get(e.token);t&&t.setCancelledTyping()},this.USER_BECAME_OWNER=function(e){Talkio.Variables.owners.add(e.user),Talkio.Variables.channel_settings.set(e.chat)},this.USER_RESIGNED_OWNERSHIP=function(e){Talkio.Variables.messages.reset(),Talkio.Variables.owners.remove(e.user.token),Talkio.Variables.channel_settings.set(e.chat),Talkio.Variables.chat_room.removeExpiredMessages()},this.USER_BANNED=function(e){Talkio.Variables.users.get(e.user.token).ban()},this.USER_UNBANNED=function(e){Talkio.Variables.users.get(e.user.token).unban()}};$(function(){new FastClick($("body")[0]),window!=window.top&&$("html").addClass("isIframe")});